!function(){"use strict";function a(){}function b(){}angular.module("gjTimerApp",["ui.bootstrap","gjTimer"]),angular.module("gjTimerApp").config(a).run(b)}(),function(){"use strict";angular.module("gjTimer.services",[]),angular.module("gjTimer.filters",[]),angular.module("gjTimer",["gjTimer.services","gjTimer.filters","cub","menuBar","results","scramble","statistics","timer"])}(),function(){"use strict";function a(a,b){var c="#FFFFFF",d="#EEEEEE",e=32,f=13;a.style={body:{},section:{},timer:{}},a.keydown=function(c){event.keyCode===f?b.$broadcast("new scramble",a.eventId):event.keyCode===e&&event.preventDefault(),b.$broadcast("keydown",c)},a.keyup=function(a){b.$broadcast("keyup",a)},a.$on("timer focus",function(){a.style.body={"background-color":d},a.style.section={display:"none"},a.style.timer={"margin-top":"2.9375em"}}),a.$on("timer unfocus",function(){a.style.body={"background-color":c},a.style.section={display:"block"},a.style.timer={}})}angular.module("gjTimer").controller("gjTimerController",["$scope","$rootScope",a])}(),function(){"use strict";function a(){return function(a){return void 0!==a?a.slice().reverse():[]}}angular.module("gjTimer.filters").filter("reverse",a)}(),function(){"use strict";function a(){var a=this;a.DNF=864e6,a.calculateAverage=function(b){if(b.length<3)return a.DNF;var c=b.slice(0);return c.splice(c.indexOf(Math.min.apply(null,c)),1),c.splice(c.indexOf(Math.max.apply(null,c)),1),c.indexOf(a.DNF)>=0?a.DNF:Number((c.reduce(function(a,b){return a+b},0)/c.length).toFixed(0))},a.calculateMean=function(b){return b.indexOf(a.DNF)>=0||0===b.length?a.DNF:Number((b.reduce(function(a,b){return a+b},0)/b.length).toFixed(0))},a.calculateSessionMean=function(b){for(var c=b.slice(0),d=0;d<c.length;d++)c[d]===a.DNF&&c.splice(d,1);return 0===c.length?a.DNF:Number((c.reduce(function(a,b){return a+b},0)/c.length).toFixed(0))},a.calculateBestAverage=function(b,c){for(var d,e=a.DNF,f=-1,g=0;g<b.length-c;g++)d=a.calculateAverage(b.slice(g,g+c)),e>d&&(e=d,f=g);return{index:f,avg:e,stDev:e!==a.DNF?a.calculateStandardDeviation(b.slice(f,f+c),!0):-1}},a.calculateBestMean=function(b,c){for(var d,e=a.DNF,f=-1,g=0;g<b.length-c;g++)d=a.calculateMean(b.slice(g,g+c)),e>d&&(e=d,f=g);return{index:f,mean:e,stDev:e!==a.DNF?a.calculateStandardDeviation(b.slice(f,f+c),!1):-1}},a.calculateStandardDeviation=function(b,c){var d=b.slice(0);c&&(d.splice(d.indexOf(Math.min.apply(null,d)),1),d.splice(d.indexOf(Math.max.apply(null,d)),1));var e=a.calculateMean(d),f=d.map(function(a){return Math.pow(a-e,2)});return Math.sqrt(a.calculateMean(f))},a.extractRawTimes=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].rawTime);return b},a.countNonDNFs=function(b){for(var c=0,d=0;d<b.length;d++)b[d]!==a.DNF&&(c+=1);return c},a.convertTimeFromStringToMilliseconds=function(b){if("DNF"===b)return a.DNF;if("N/A"===b)return-1;var c=b.split(":");return 1===c.length?Number((1e3*parseFloat(c[0])).toFixed()):2===c.length?Number((60*parseFloat(c[0])*1e3+1e3*parseFloat(c[1])).toFixed()):3===c.length?Number((60*parseFloat(c[0])*60*1e3+60*parseFloat(c[1])*1e3+1e3*parseFloat(c[2])).toFixed()):a.DNF},a.convertTimeFromMillisecondsToString=function(b,c){if(b===a.DNF)return"DNF";if(0>b)return"N/A";var d=moment(b),e=2===c?"SS":"SSS";return 1e4>b?d.format("s."+e):6e4>b?d.format("ss."+e):36e5>b?d.format("m:ss."+e):d.utc().format("H:mm:ss."+e)}}angular.module("gjTimer.services").service("Calculator",a)}(),function(){"use strict";function a(){var a=this;a.events={333:{index:0,name:"Rubik's Cube",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},444:{index:1,name:"4x4 Cube",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},555:{index:2,name:"5x5 Cube",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},222:{index:3,name:"2x2 Cube",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},"333bf":{index:4,name:"3x3 blindfolded",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},"333oh":{index:5,name:"3x3 one-handed",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},minx:{index:6,name:"Megaminx",style:{"font-size":"13pt"},svg:{ratio:.51,width:175}},pyram:{index:7,name:"Pyraminx",style:{"font-size":"16pt"},svg:{ratio:.69,width:250}},sq1:{index:8,name:"Square-1",style:{"font-size":"15pt"},svg:{ratio:.57,width:175}},clock:{index:9,name:"Rubik's Clock",style:{"font-size":"15pt"},svg:{ratio:.5,width:175}},666:{index:10,name:"6x6 Cube",style:{"font-size":"13pt"},svg:{ratio:.75,width:250}},777:{index:11,name:"7x7 Cube",style:{"font-size":"13pt"},svg:{ratio:.75,width:250}},"444bf":{index:12,name:"4x4 blindfolded",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},"555bf":{index:13,name:"5x5 blindfolded",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}}},a.getEvents=function(){var b=[];return angular.forEach(a.events,function(a){b[a.index]=a.name}),b},a.getEvent=function(b){return a.events.hasOwnProperty(b)?a.events[b].name:null},a.getEventId=function(b){for(var c in a.events)if(a.events.hasOwnProperty(c)&&a.events[c].name===b)return c;return null},a.getEventStyle=function(b){return a.events.hasOwnProperty(b)?a.events[b].style:a.events[333].style},a.getEventSvg=function(b){return a.events.hasOwnProperty(b)?a.events[b].svg:a.events[333].svg}}angular.module("gjTimer.services").service("Events",a)}(),function(){"use strict";function a(){var a=this;a.get=function(a){return localStorage.getItem(a)},a.set=function(a,b){try{return localStorage.setItem(a,b),!0}catch(c){return!1}},a.getJSON=function(a){var b=localStorage.getItem(a);return null!==b?JSON.parse(b):null},a.setJSON=function(a,b){try{return localStorage.setItem(a,JSON.stringify(b)),!0}catch(c){return!1}},a.clear=function(){try{return localStorage.clear(),!0}catch(a){return!1}}}angular.module("gjTimer.services").service("LocalStorage",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/cub/cub.html",controller:"CubController",controllerAs:"ctrl",scope:{eventId:"="}}}angular.module("cub",[]).directive("cub",a)}(),function(){"use strict";function a(a,b){var c=this;a.$on("draw scramble",function(a,d,e){c.cub=b.drawScramble(d,e)})}angular.module("cub").controller("CubController",["$scope","CubService",a])}(),function(){"use strict";function a(a,b){var c=this;c.drawScramble=function(c,d){var e=b.getEventSvg(c).width,f=e/b.getEventSvg(c).ratio,g=document.createElement("div");scramblers[c].drawScramble(g,d,f,e);var h=document.createElement("div");return h.appendChild(g),a.trustAsHtml(h.innerHTML)}}angular.module("cub").service("CubService",["$sce","Events",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/menuBar/menuBar.html",controller:"MenuBarController",controllerAs:"ctrl",scope:{eventId:"=",sessionId:"=",settings:"="}}}angular.module("menuBar",[]).directive("menuBar",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;g.sessions=e.initSessions(),g.session=e.initSession(),g.events=f.getEvents(),g.event={eventId:g.session.eventId,event:f.getEvent(g.session.eventId)},a.sessionId=g.session.sessionId,a.eventId=g.session.eventId,a.settings={precision:2,timerPrecision:3,timerStartDelay:100,timerStopDelay:100,timerRefreshInterval:50},c(function(){b.$broadcast("new scramble",a.eventId)},50),g.changeSession=function(c){g.session=e.changeSession(c),a.sessionId=c,a.eventId=g.session.eventId,b.$broadcast("refresh data",c),g.event.eventId!==g.session.eventId&&b.$broadcast("new scramble",a.eventId),g.event={eventId:a.eventId,event:f.getEvent(a.eventId)}},g.changeEvent=function(c){a.eventId=e.changeEvent(a.sessionId,f.getEventId(c)),g.session.eventId=a.eventId,g.event={eventId:a.eventId,event:f.getEvent(a.eventId)},b.$broadcast("new scramble",a.eventId)},g.settings=function(){d.open({animation:!0,templateUrl:"dist/components/gjTimer/settings/settings.html",controller:"SettingsController",controllerAs:"ctrl",size:"md",resolve:{settings:function(){return a.settings}}})},g.resetSession=function(){confirm("Are you sure you want to reset "+a.sessionId+"?")&&(g.session=e.resetSession(a.sessionId),b.$broadcast("refresh data",a.sessionId))}}angular.module("menuBar").controller("MenuBarController",["$scope","$rootScope","$timeout","$uibModal","MenuBarService","Events",a])}(),function(){"use strict";function a(a){var b=this,c=15;b.initSessions=function(){for(var b=[],d=1;c>=d;d++){b.push("Session "+d);var e=a.getJSON("Session "+d);null===e&&a.setJSON("Session "+d,{sessionId:"Session "+d,eventId:"333",results:[]})}return b},b.initSession=function(){var b;return null!==a.get("sessionId")?b=a.get("sessionId"):(b="Session 1",a.set("sessionId","Session 1")),a.getJSON(b)},b.getSession=function(b){return a.getJSON(b)},b.changeSession=function(b){return a.set("sessionId",b),a.getJSON(b)},b.resetSession=function(b){var c=a.getJSON(b);return c.results=[],a.setJSON(b,c),c},b.changeEvent=function(b,c){var d=a.getJSON(b);return d.eventId=c,a.setJSON(b,d),d.eventId}}angular.module("menuBar").service("MenuBarService",["LocalStorage",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/results/results.html",controller:"ResultsController",controllerAs:"ctrl",scope:{results:"=",sessionId:"=",settings:"="}}}angular.module("results",[]).directive("results",a)}(),function(){"use strict";function a(a,b,c){var d=this;a.results=c.getResults(a.sessionId,a.settings.precision),d.results=a.results,a.$on("refresh data",function(b,e){a.results=c.getResults(e,a.settings.precision),d.results=a.results,"$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase&&a.$apply()}),d.openModal=function(c,d){c>=d&&b.open({animation:!0,templateUrl:"dist/components/gjTimer/resultsModal/resultsModal.html",controller:"ResultsModalController",controllerAs:"ctrl",size:"lg",resolve:{results:function(){return a.results.slice(c-d,c)}}})}}angular.module("results").controller("ResultsController",["$scope","$uibModal","ResultsService",a])}(),function(){"use strict";function a(a,b){var c=this,d=b.DNF;c.getResults=function(c,e){var f=[],g=a.getJSON(c).results;angular.forEach(g,function(a,c){var g=a.split("|"),h={index:c,scramble:g[1],date:new Date(Number(g[2])),comment:g[3]?g[3]:""};"+"===g[0].substring(g[0].length-1,g[0].length)?(h.time=Number(g[0].substring(0,g[0].length-1)),h.penalty="+2",h.rawTime=Number((h.time+2e3).toFixed()),h.displayedTime=b.convertTimeFromMillisecondsToString(Number(g[0].substring(0,g[0].length-1))+2e3,e)+"+",h.detailedTime=b.convertTimeFromMillisecondsToString(Number(g[0].substring(0,g[0].length-1))+2e3,e)+"+"):"-"===g[0].substring(g[0].length-1,g[0].length)?(h.time=Number(g[0].substring(0,g[0].length-1)),h.penalty="DNF",h.rawTime=d,h.displayedTime="DNF",h.detailedTime="DNF("+b.convertTimeFromMillisecondsToString(Number(g[0].substring(0,g[0].length-1)),e)+")"):(h.time=Number(g[0]),h.penalty="",h.rawTime=h.time,h.displayedTime=b.convertTimeFromMillisecondsToString(Number(g[0]),e),h.detailedTime=b.convertTimeFromMillisecondsToString(Number(g[0]),e)),f.push(h)});var h=b.extractRawTimes(f);return angular.forEach(f,function(a,c){c>=4?a.avg5=b.convertTimeFromMillisecondsToString(b.calculateAverage(h.slice(c-4,c+1)),e):a.avg5="DNF",c>=11?a.avg12=b.convertTimeFromMillisecondsToString(b.calculateAverage(h.slice(c-11,c+1)),e):a.avg12="DNF"}),f}}angular.module("results").service("ResultsService",["LocalStorage","Calculator",a])}(),function(){"use strict";function a(a,b,c){var d=this;d.results=c.getModalResults(b),d.type=3===b.length?"mean":"average",d.close=function(){a.dismiss()}}angular.module("results").controller("ResultsModalController",["$modalInstance","results","ResultsModalService",a])}(),function(){"use strict";function a(a){var b=this;b.getModalResults=function(b){var c=a.extractRawTimes(b);return b[c.indexOf(Math.min.apply(null,c))].min=!0,b[c.indexOf(Math.max.apply(null,c))].max=!0,{results:b,avg:a.convertTimeFromMillisecondsToString(a.calculateAverage(c)),stDev:a.convertTimeFromMillisecondsToString(a.calculateStandardDeviation(c,!0))}}}angular.module("results").service("ResultsModalService",["Calculator",a])}(),function(){"use strict";function a(a,b,c,d,e,f){var g=function(){var a=d.defer(),b=e.get("dist/components/gjTimer/resultsPopover/resultsPopover.html");return"undefined"==typeof b?c.get("dist/components/gjTimer/resultsPopover/resultsPopover.html").success(function(b){e.put("dist/components/gjTimer/resultsPopover/resultsPopover.html",b),a.resolve(b)}):a.resolve(b),a.promise};return{restrict:"E",scope:{index:"=",result:"=",sessionId:"="},controller:"ResultsPopoverController",controllerAs:"ctrl",link:function(c,d,e){g().then(function(e){c.popoverDelay=1,a.insidePopover=-1,$(d).popover({animation:!1,content:e,html:!0,placement:"right",title:c.result.detailedTime}),$(d).bind("mouseenter",function(){c.insideDiv=c.index,b(function(){$(d).popover("show"),c.attachEvents(d)},c.popoverDelay)}),$(d).bind("mouseleave",function(){c.insideDiv=-1,b(function(){a.insidePopover!==c.index&&$(d).popover("hide")},c.popoverDelay)})})}}}angular.module("results").directive("resultsPopover",["$rootScope","$timeout","$http","$q","$templateCache","ResultsService",a])}(),function(){"use strict";function a(a,b,c,d){a.attachEvents=function(e){$(".popover").on("mouseenter",function(){b.insidePopover=a.index}).on("mouseleave",function(){b.insidePopover=-1,c(function(){a.insideDiv!==a.index&&$(e).popover("hide")},a.popoverDelay)}),$(".popover-btn-penalty-ok").on("click",function(){d.penalty(a.sessionId,a.index,""),b.$broadcast("refresh data",a.sessionId),$(e).popover("hide")}),$(".popover-btn-penalty-plus").on("click",function(){d.penalty(a.sessionId,a.index,"+2"),b.$broadcast("refresh data",a.sessionId),$(e).popover("hide")}),$(".popover-btn-penalty-dnf").on("click",function(){d.penalty(a.sessionId,a.index,"DNF"),b.$broadcast("refresh data",a.sessionId),$(e).popover("hide")}),$(".popover-btn-remove").on("click",function(){confirm("Are you sure you want to delete this time?")&&(d.remove(a.sessionId,a.index),b.$broadcast("refresh data",a.sessionId)),$(e).popover("hide")})}}angular.module("results").controller("ResultsPopoverController",["$scope","$rootScope","$timeout","ResultsPopoverService",a])}(),function(){"use strict";function a(a){var b=this;b.penalty=function(b,c,d){var e=a.getJSON(b),f=e.results[c],g=f.substring(f.indexOf("|")-1,f.indexOf("|"));switch(d){case"":("+"===g||"-"===g)&&(f=f.substring(0,f.indexOf("|")-1)+f.substring(f.indexOf("|"),f.length));break;case"+2":f="+"===g||"-"===g?f.substring(0,f.indexOf("|")-1)+"+"+f.substring(f.indexOf("|"),f.length):f.substring(0,f.indexOf("|"))+"+"+f.substring(f.indexOf("|"),f.length);break;case"DNF":f="+"===g||"-"===g?f.substring(0,f.indexOf("|")-1)+"-"+f.substring(f.indexOf("|"),f.length):f.substring(0,f.indexOf("|"))+"-"+f.substring(f.indexOf("|"),f.length)}e.results[c]=f,a.setJSON(b,e)},b.remove=function(a,b){var c=JSON.parse(localStorage.getItem(a));c.results.splice(b,1),localStorage.setItem(a,JSON.stringify(c))},b.comment=function(a,b,c){console.log("comment "+a+" - "+b+" - "+c)}}angular.module("results").service("ResultsPopoverService",["LocalStorage",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/scramble/scramble.html",controller:"ScrambleController",controllerAs:"ctrl",scope:{eventId:"=",scramble:"="}}}angular.module("scramble",[]).directive("scramble",a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this;a.$on("new scramble",function(g,h){a.scramble=d.getNewScramble(h),f.scramble=c.trustAsHtml(a.scramble),f.scrambleStyle=e.getEventStyle(h),b.$broadcast("draw scramble",h,d.getScrambleState())})}angular.module("scramble").controller("ScrambleController",["$scope","$rootScope","$sce","ScrambleService","Events",a])}(),function(){"use strict";function a(){var a=this;a.getScrambleState=function(){return a.scramble.state},a.getNewScramble=function(b){return a.scramble=scramblers[b].getRandomScramble()," "===a.scramble.scramble_string.substring(a.scramble.scramble_string.length-1,a.scramble.scramble_string.length)?a.scramble.scramble_string.substring(0,a.scramble.scramble_string.length-1):a.scramble.scramble_string}}angular.module("scramble").service("ScrambleService",a)}(),function(){"use strict";function a(a,b,c){var d=this;d.settings=b,d.close=function(){a.dismiss()}}angular.module("menuBar").controller("SettingsController",["$modalInstance","settings","MenuBarService",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/statistics/statistics.html",controller:"StatisticsController",controllerAs:"ctrl",scopeId:{results:"="}}}angular.module("statistics",[]).directive("statistics",a)}(),function(){"use strict";function a(a,b,c){var d=this;a.$watch("results",function(){d.statistics=c.getStatistics(a.results)}),d.openModal=function(c,e){var f=d.statistics.averages[e].length,g="best"===c?d.statistics.averages[e].best.index:a.results.length-f;b.open({animation:!0,templateUrl:"dist/components/gjTimer/resultsModal/resultsModal.html",controller:"ResultsModalController",controllerAs:"ctrl",size:"lg",resolve:{results:function(){return a.results.slice(g,g+f)}}})}}angular.module("statistics").controller("StatisticsController",["$scope","$uibModal","StatisticsService",a])}(),function(){"use strict";function a(a){var b=this;b.getStatistics=function(b){var c,d=a.extractRawTimes(b),e={solves:{attempted:d.length,solved:a.countNonDNFs(d),best:a.convertTimeFromMillisecondsToString(Math.min.apply(null,d)),worst:a.convertTimeFromMillisecondsToString(Math.max.apply(null,d))},sessionMean:{mean:a.convertTimeFromMillisecondsToString(a.calculateSessionMean(d)),stDev:a.convertTimeFromMillisecondsToString(a.calculateStandardDeviation(d,!1))},sessionAvg:{avg:a.convertTimeFromMillisecondsToString(a.calculateAverage(d)),stDev:a.convertTimeFromMillisecondsToString(a.calculateStandardDeviation(d,!0))},averages:[]};d.length>=3&&(c=a.calculateBestMean(d,3),e.averages.push({type:"m",length:3,current:{avg:a.convertTimeFromMillisecondsToString(a.calculateMean(d.slice(d.length-3,d.length))),stDev:a.convertTimeFromMillisecondsToString(a.calculateStandardDeviation(d.slice(d.length-3,d.length),!1))},best:{avg:a.convertTimeFromMillisecondsToString(c.mean),stDev:a.convertTimeFromMillisecondsToString(c.stDev)}}));for(var f=[5,12,50,100],g=0;g<f.length;g++)d.length>=f[g]&&(c=a.calculateBestAverage(d,f[g]),e.averages.push({type:"a",length:f[g],current:{avg:a.convertTimeFromMillisecondsToString(a.calculateAverage(d.slice(d.length-f[g],d.length))),stDev:a.convertTimeFromMillisecondsToString(a.calculateStandardDeviation(d.slice(d.length-f[g],d.length),!0))},best:{avg:a.convertTimeFromMillisecondsToString(c.avg),stDev:a.convertTimeFromMillisecondsToString(c.stDev)}}));return e}}angular.module("statistics").service("StatisticsService",["Calculator",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/timer/timer.html",controller:"TimerController",controllerAs:"ctrl",scope:{eventId:"=",scramble:"=",sessionId:"=",settings:"="}}}angular.module("timer",[]).directive("timer",a)}(),function(){"use strict";function a(a,b,c,d,e){var f,g=this,h="reset",i=32;g.time=2===a.settings.timerPrecision?moment(0).format("s.SS"):moment(0).format("s.SSS");var j={BLACK:{color:"#000000"},RED:{color:"#FF0000"},GREEN:{color:"#2EB82E"}};a.$on("keydown",function(k,l){"reset"===h&&l.keyCode===i?(h="keydown",g.time=2===a.settings.timerPrecision?moment(0).format("s.SS"):moment(0).format("s.SSS"),g.timerStyle=j.RED,d(function(){"keydown"===h&&(h="ready",g.timerStyle=j.GREEN,b.$broadcast("timer focus"))},a.settings.timerStartDelay)):"timing"===h&&(h="stopped",c.cancel(f),b.$broadcast("timer unfocus"),e.saveResult(g.time,a.scramble,a.sessionId),b.$broadcast("refresh data",a.sessionId),b.$broadcast("new scramble",a.eventId))}),a.$on("keyup",function(b,k){g.timerStyle=j.BLACK,"ready"===h&&k.keyCode===i?(h="timing",e.startTimer(),f=c(function(){g.time=e.getTime(a.settings.timerPrecision)},a.settings.timerRefreshInterval)):"keydown"===h?h="reset":"stopped"===h&&d(function(){h="reset"},a.settings.timerStopDelay)})}angular.module("timer").controller("TimerController",["$scope","$rootScope","$interval","$timeout","TimerService",a])}(),function(){"use strict";function a(a,b){var c=this;c.getTime=function(a){return b.convertTimeFromMillisecondsToString(moment(Date.now()-c.startTime),a)},c.startTimer=function(){c.startTime=Date.now()},c.saveResult=function(c,d,e){var f=a.getJSON(e);f.results.push(b.convertTimeFromStringToMilliseconds(c)+"|"+d+"|"+Date.now()),a.setJSON(e,f)}}angular.module("timer").service("TimerService",["LocalStorage","Calculator",a])}();