!function(){"use strict";function a(){}function b(a,b){a.get("dist/components/gjTimer/resultsPopover/resultsPopover.html").success(function(a){b.put("resultsPopover.html",a)})}angular.module("gjTimerApp",["ui.bootstrap","gjTimer"]),angular.module("gjTimerApp").config(a).run(["$http","$templateCache",b])}(),function(){"use strict";angular.module("gjTimer.services",[]),angular.module("gjTimer.filters",[]),angular.module("gjTimer",["gjTimer.services","gjTimer.filters","charts","cub","menuBar","results","scramble","statistics","timer"])}(),function(){"use strict";function a(a,b,c){b.isTyping=!1,a.style={},a.keydown=function(d){event.keyCode===c.KEY_CODES.ENTER?b.isTypingComment?event.preventDefault():b.isTyping||b.$broadcast("new scramble",a.eventId):event.keyCode===c.KEY_CODES.SPACE_BAR&&event.preventDefault(),b.$broadcast("keydown",d)},a.keyup=function(a){b.$broadcast("keyup",a)},a.$on("timer focus",function(){a.style.body=a.settings.backgroundColor,a.settings.backgroundColor=a.settings.panelColor,a.style.section={display:"none"},a.style.timer={"margin-top":"2.9375em"}}),a.$on("timer unfocus",function(){a.style.body&&(a.settings.backgroundColor=a.style.body),a.style.section={display:"block"},a.style.timer={}})}angular.module("gjTimer").controller("gjTimerController",["$scope","$rootScope","Constants",a])}(),function(){"use strict";function a(){return function(a){return void 0!==a?a.slice().reverse():[]}}angular.module("gjTimer.filters").filter("reverse",a)}(),function(){"use strict";function a(a){var b=this;b.calculateAverage=function(b,c){var d=b.slice(0);return c&&(d.splice(d.indexOf(Math.min.apply(null,d)),1),d.splice(d.indexOf(Math.max.apply(null,d)),1)),d.indexOf(a.DNF)>=0||0===d.length?a.DNF:Number((d.reduce(function(a,b){return a+b},0)/d.length).toFixed())},b.calculateAverageString=function(a,c,d){return b.convertTimeFromMillisecondsToString(b.calculateAverage(a,c),d)},b.calculateStandardDeviation=function(c,d){var e=c.slice(0);if(d&&(e.splice(e.indexOf(Math.min.apply(null,e)),1),e.splice(e.indexOf(Math.max.apply(null,e)),1)),e.indexOf(a.DNF)>=0||0===e.length)return a.DNF;var f=b.calculateAverage(e,!1),g=e.map(function(a){return Math.pow(a-f,2)});return Number(Math.sqrt(b.calculateAverage(g,!1)).toFixed())},b.calculateStandardDeviationString=function(a,c,d){return b.convertTimeFromMillisecondsToString(b.calculateStandardDeviation(a,c),d)},b.calculateSessionMeanAndStandardDeviationString=function(c,d){var e=c.slice(0).filter(function(b){return b!==a.DNF});return{mean:b.calculateAverageString(e,!1,d),stDev:b.calculateStandardDeviationString(e,!1,d)}},b.calculateBestAverageAndStandardDeviationString=function(c,d,e,f){for(var g,h=a.DNF,i=-1,j=0;j<=c.length-e;j++)g=b.calculateAverage(c.slice(j,j+e),d),h>g&&(h=g,i=j);return{index:i,avg:b.convertTimeFromMillisecondsToString(h,f),stDev:b.calculateStandardDeviationString(c.slice(i,i+e),d,f)}},b.extractRawTimes=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].rawTime);return b},b.countNonDNFs=function(b){return b.slice(0).filter(function(b){return b!==a.DNF}).length},b.convertTimeFromStringToMilliseconds=function(b){if("DNF"===b)return a.DNF;var c=b.split(":");return 1===c.length?Number((1e3*parseFloat(c[0])).toFixed()):2===c.length?Number((60*parseFloat(c[0])*1e3+1e3*parseFloat(c[1])).toFixed()):3===c.length?Number((60*parseFloat(c[0])*60*1e3+60*parseFloat(c[1])*1e3+1e3*parseFloat(c[2])).toFixed()):a.DNF},b.convertTimeFromMillisecondsToString=function(b,c){if(b===a.DNF||0>b||b===1/0)return"DNF";var d,e=moment(b);switch(c){case 0:d="";break;case 1:d=".S";break;case 2:d=".SS";break;case 3:d=".SSS";break;default:d=".SS"}return 1e4>b?e.format("s"+d):6e4>b?e.format("ss"+d):36e5>b?e.format("m:ss"+d):e.utc().format("H:mm:ss"+d)}}angular.module("gjTimer.services").service("Calculator",["Constants",a])}(),function(){"use strict";function a(){var a=this;a.DNF=864e6,a.KEY_CODES={ENTER:13,ESCAPE:27,SPACE_BAR:32},a.COLORS={BLACK:"#000000",RED:"#FF0000",ORANGE:"#FFA500",GREEN:"#2EB82E",BLUE:"#0000FF",GRAY:"#EEEEEE",WHITE:"#FFFFFF"},a.STYLES={COLOR:{BLACK:{color:a.COLORS.BLACK},RED:{color:a.COLORS.RED},ORANGE:{color:a.COLORS.ORANGE},GREEN:{color:a.COLORS.GREEN},BLUE:{color:a.COLORS.BLUE}},BACKGROUND_COLOR:{GRAY:{"background-color":a.COLORS.GRAY},WHITE:{"background-color":a.COLORS.WHITE}}},a.SESSIONS={DEFAULT_NUMBER_OF_SESSIONS:15};var b=[{value:{"background-color":"#FFFFFF"}},{value:{"background-color":"#EEEEEE"}},{value:{"background-color":"#FFE5EE"}},{value:{"background-color":"#FFCCCC"}},{value:{"background-color":"#FFE8D2"}},{value:{"background-color":"#FFFFCC"}},{value:{"background-color":"#D7FFD7"}},{value:{"background-color":"#E5F5FF"}},{value:{"background-color":"#FFE5FF"}},{value:{"background-color":"#F1E3D4"}}];a.DEFAULT_SETTINGS={input:"Timer",inspection:!1,bldMode:!1,timerPrecision:3,timerStartDelay:0,timerRefreshInterval:50,showScramble:!0,saveScramble:!0,resultsPrecision:2,statisticsPrecision:3,panelColor:{"background-color":"#EEEEEE"},backgroundColor:{"background-color":"#FFFFFF"}},a.SETTINGS=[{id:"input",title:"Input",options:[{value:"Timer",text:"Timer"},{value:"Typing",text:"Typing"}]},{id:"inspection",title:"Inspection",options:[{value:!0,text:"On"},{value:!1,text:"Off"}]},{id:"bldMode",title:"BLD Mode",options:[{value:!0,text:"On"},{value:!1,text:"Off"}]},{id:"timerPrecision",title:"Timer Precision",options:[{value:0,text:"0"},{value:1,text:"0.1"},{value:2,text:"0.01"},{value:3,text:"0.001"}]},{id:"timerStartDelay",title:"Timer Start Delay",options:[{value:0,text:"0"},{value:100,text:"0.1"},{value:500,text:"0.5"},{value:1e3,text:"1"}]},{id:"timerRefreshInterval",title:"Timer Refresh",options:[{value:50,text:"0.05"},{value:100,text:"0.1"}]},{id:"showScramble",title:"Show Scramble",options:[{value:!0,text:"Yes"},{value:!1,text:"No"}]},{id:"saveScramble",title:"Save Scramble",options:[{value:!0,text:"Yes"},{value:!1,text:"No"}]},{id:"resultsPrecision",title:"Results Precision",options:[{value:2,text:"0.01"},{value:3,text:"0.001"}]},{id:"statisticsPrecision",title:"Stats Precision",options:[{value:2,text:"0.01"},{value:3,text:"0.001"}]},{id:"panelColor",title:"Panel Color",options:b},{id:"backgroundColor",title:"Background Color",options:b}]}angular.module("gjTimer.services").service("Constants",a)}(),function(){"use strict";function a(){var a=this;a.events={333:{index:0,name:"Rubik's Cube",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},444:{index:1,name:"4x4 Cube",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},555:{index:2,name:"5x5 Cube",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},222:{index:3,name:"2x2 Cube",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},"333bf":{index:4,name:"3x3 blindfolded",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},"333oh":{index:5,name:"3x3 one-handed",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},minx:{index:6,name:"Megaminx",style:{"font-size":"13pt"},svg:{ratio:.51,width:175}},pyram:{index:7,name:"Pyraminx",style:{"font-size":"16pt"},svg:{ratio:.69,width:250}},sq1:{index:8,name:"Square-1",style:{"font-size":"15pt"},svg:{ratio:.57,width:175}},clock:{index:9,name:"Rubik's Clock",style:{"font-size":"15pt"},svg:{ratio:.5,width:175}},666:{index:10,name:"6x6 Cube",style:{"font-size":"13pt"},svg:{ratio:.75,width:250}},777:{index:11,name:"7x7 Cube",style:{"font-size":"13pt"},svg:{ratio:.75,width:250}},"444bf":{index:12,name:"4x4 blindfolded",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},"555bf":{index:13,name:"5x5 blindfolded",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}}},a.getEvents=function(){var b=[];return angular.forEach(a.events,function(a){b[a.index]=a.name}),b},a.getEvent=function(b){return a.events.hasOwnProperty(b)?a.events[b].name:null},a.getEventId=function(b){for(var c in a.events)if(a.events.hasOwnProperty(c)&&a.events[c].name===b)return c;return null},a.getEventStyle=function(b){return a.events.hasOwnProperty(b)?a.events[b].style:a.events[333].style},a.getEventSvg=function(b){return a.events.hasOwnProperty(b)?a.events[b].svg:a.events[333].svg}}angular.module("gjTimer.services").service("Events",a)}(),function(){"use strict";function a(){var a=this;a.get=function(a){return localStorage.getItem(a)},a.set=function(a,b){try{return localStorage.setItem(a,b),!0}catch(c){return!1}},a.getJSON=function(a){var b=localStorage.getItem(a);return null!==b?JSON.parse(b):null},a.setJSON=function(a,b){try{return localStorage.setItem(a,JSON.stringify(b)),!0}catch(c){return!1}},a.clear=function(){try{return localStorage.clear(),!0}catch(a){return!1}}}angular.module("gjTimer.services").service("LocalStorage",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/charts/charts.html",controller:"ChartsController",controllerAs:"ctrl",scope:{results:"=",settings:"="},bindToController:!0}}angular.module("charts",[]).directive("charts",a)}(),function(){"use strict";function a(a,b){var c,d,e,f,g,h=this;c=document.getElementById("lineChart").getContext("2d"),d=b.getLineChartOptions(),a.$watchCollection(function(){return h.results},function(){h.refreshData()}),a.$on("refresh statistics",function(){h.refreshData()}),$(window).resize(function(){h.refreshCanvas()}),h.refreshData=function(){e=b.getLineChartData(h.results.slice(h.results.length-g,h.results.length));for(var a=0;a<e.datasets.length;a++)for(var c=0;c<e.datasets[a].data.length;c++)f.datasets[a].points[c].value=e.datasets[a].data[c],f.datasets[a].points[c].label=e.labels[c];f.update()},h.refreshCanvas=function(){$("#lineChart").width($("#charts").width()),$("#lineChart").height($("#charts").height()),g=Number($("#charts").width().toFixed())/25,e=b.getLineChartData(h.results.slice(h.results.length-g,h.results.length)),f=new Chart(c).Line(e,d)},h.refreshCanvas()}angular.module("charts").controller("ChartsController",["$scope","ChartsService",a])}(),function(){"use strict";function a(a){var b=this;b.getLineChartData=function(b){for(var c={indices:[],singles:[],avg5:[],avg12:[]},d=0;d<b.length;d++)c.indices.push(b[d].index),c.singles.push(b[d].rawTime/1e3),c.avg5.push(a.convertTimeFromStringToMilliseconds(b[d].avg5)/1e3),c.avg12.push(a.convertTimeFromStringToMilliseconds(b[d].avg12)/1e3);return{labels:c.indices,datasets:[{label:"Single",fillColor:"rgba(150,150,150,0.2)",strokeColor:"rgba(150,150,150,1)",pointColor:"rgba(150,150,150,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(150,150,150,1)",data:c.singles},{label:"Avg 5",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:c.avg5},{label:"Avg 12",fillColor:"rgba(190,145,195,0.2)",strokeColor:"rgba(190,145,195,1)",pointColor:"rgba(190,145,195,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(190,145,195,1)",data:c.avg12}]}},b.getLineChartOptions=function(){return{animation:!1,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!1,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'}}}angular.module("charts").service("ChartsService",["Calculator",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/cub/cub.html",controller:"CubController",controllerAs:"ctrl",scope:{settings:"="},bindToController:!0}}angular.module("cub",[]).directive("cub",a)}(),function(){"use strict";function a(a,b){var c=this;a.$on("draw scramble",function(a,d,e){c.cub=b.drawScramble(d,e)})}angular.module("cub").controller("CubController",["$scope","CubService",a])}(),function(){"use strict";function a(a,b){var c=this;c.drawScramble=function(c,d){var e=b.getEventSvg(c).width,f=e/b.getEventSvg(c).ratio,g=document.createElement("div");scramblers[c].drawScramble(g,d,f,e);var h=document.createElement("div");return h.appendChild(g),a.trustAsHtml(h.innerHTML)}}angular.module("cub").service("CubService",["$sce","Events",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/menuBar/menuBar.html",controller:"MenuBarController",controllerAs:"ctrl",scope:{eventId:"=",results:"=",sessionId:"=",settings:"="},bindToController:!0}}angular.module("menuBar",[]).directive("menuBar",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;g.settings=e.initSettings(),g.sessions=e.initSessions(),g.session=e.initSession(),g.events=f.getEvents(),g.event={eventId:g.session.eventId,event:f.getEvent(g.session.eventId)},g.sessionId=g.session.sessionId,g.eventId=g.session.eventId,g.showDetails=window.innerWidth>500,$(window).resize(function(){g.showDetails=window.innerWidth>500,a.$apply()}),c(function(){b.$broadcast("new scramble",g.eventId)},50),g.changeSession=function(a){g.session=e.changeSession(a),g.sessionId=a,g.eventId=g.session.eventId,b.$broadcast("refresh results",a),g.event.eventId!==g.session.eventId&&b.$broadcast("new scramble",g.eventId),g.event={eventId:g.eventId,event:f.getEvent(g.eventId)}},g.changeEvent=function(a){g.eventId=e.changeEvent(g.sessionId,f.getEventId(a)),g.session.eventId=g.eventId,g.event={eventId:g.eventId,event:f.getEvent(g.eventId)},b.$broadcast("new scramble",g.eventId)},g.openSettings=function(){d.open({animation:!0,templateUrl:"dist/components/gjTimer/settings/settings.html",controller:"SettingsController",controllerAs:"ctrl",size:"md",resolve:{settings:function(){return g.settings}}})},g.resetSession=function(){confirm("Are you sure you want to reset "+g.sessionId+"?")&&(e.resetSession(g.sessionId),g.session.results=[],g.results=[])}}angular.module("menuBar").controller("MenuBarController",["$scope","$rootScope","$timeout","$uibModal","MenuBarService","Events",a])}(),function(){"use strict";function a(a,b){var c=this;c.initSettings=function(){var c=a.getJSON("settings");if(null===c)return a.setJSON("settings",b.DEFAULT_SETTINGS),b.DEFAULT_SETTINGS;for(var d in b.DEFAULT_SETTINGS)b.DEFAULT_SETTINGS.hasOwnProperty(d)&&(c.hasOwnProperty(d)||(c[d]=b.DEFAULT_SETTINGS[d],a.setJSON("settings",c)));return c},c.saveSettings=function(b){a.setJSON("settings",b)},c.resetSettings=function(){return a.setJSON("settings",b.DEFAULT_SETTINGS),b.DEFAULT_SETTINGS},c.initSessions=function(){for(var c=[],d=1;d<=b.SESSIONS.DEFAULT_NUMBER_OF_SESSIONS;d++){c.push("Session "+d);var e=a.getJSON("Session "+d);null===e&&a.setJSON("Session "+d,{sessionId:"Session "+d,eventId:"333",results:[]})}return c},c.initSession=function(){var b;return null!==a.get("sessionId")?b=a.get("sessionId"):(b="Session 1",a.set("sessionId","Session 1")),a.getJSON(b)},c.getSession=function(b){return a.getJSON(b)},c.changeSession=function(b){return a.set("sessionId",b),a.getJSON(b)},c.resetSession=function(b){var c=a.getJSON(b);c.results=[],a.setJSON(b,c)},c.changeEvent=function(b,c){var d=a.getJSON(b);return d.eventId=c,a.setJSON(b,d),d.eventId},c.resetAll=function(){a.clear()}}angular.module("menuBar").service("MenuBarService",["LocalStorage","Constants",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/results/results.html",controller:"ResultsController",controllerAs:"ctrl",scope:{results:"=",sessionId:"=",settings:"="},bindToController:!0}}angular.module("results",[]).directive("results",a)}(),function(){"use strict";function a(a,b,c){var d=this;d.results=c.getResults(d.sessionId,d.settings.resultsPrecision),a.$on("refresh results",function(a,b){d.results=c.getResults(b||d.sessionId,d.settings.resultsPrecision)}),d.openModal=function(a,c){a>=c&&b.open({animation:!0,templateUrl:"dist/components/gjTimer/resultsModal/resultsModal.html",controller:"ResultsModalController",controllerAs:"ctrl",size:"lg",resolve:{results:function(){return d.results.slice(a-c,a)},precision:function(){return d.settings.resultsPrecision}}})}}angular.module("results").controller("ResultsController",["$scope","$uibModal","ResultsService",a])}(),function(){"use strict";function a(a,b,c){var d=this,e=c.DNF;d.getResults=function(c,f){for(var g=[],h=a.getJSON(c).results,i=0;i<h.length;i++){var j=h[i].split("|"),k={index:i,scramble:j[1],date:new Date(Number(j[2])),comment:j[3]?j[3]:""};"+"===j[0].substring(j[0].length-1,j[0].length)?(k.time=Number(j[0].substring(0,j[0].length-1)),k.penalty="+2",k.rawTime=Number((k.time+2e3).toFixed()),k.displayedTime=b.convertTimeFromMillisecondsToString(Number(j[0].substring(0,j[0].length-1))+2e3,f)+"+",k.detailedTime=k.displayedTime):"-"===j[0].substring(j[0].length-1,j[0].length)?(k.time=Number(j[0].substring(0,j[0].length-1)),k.penalty="DNF",k.rawTime=e,k.displayedTime="DNF",k.detailedTime="DNF("+b.convertTimeFromMillisecondsToString(Number(j[0].substring(0,j[0].length-1)),f)+")"):(k.time=Number(j[0]),k.penalty="",k.rawTime=k.time,k.displayedTime=b.convertTimeFromMillisecondsToString(Number(j[0]),f),k.detailedTime=k.displayedTime),g.push(k)}for(var l=b.extractRawTimes(g),m=0;m<g.length;m++)g[m]=d.populateAverages(l,g[m],m,f);return g},d.saveResult=function(c,e,f,g,h,i,j,k){var l=b.convertTimeFromStringToMilliseconds(e),m=b.convertTimeFromMillisecondsToString(l,j),n={comment:g,date:new Date,detailedTime:m,displayedTime:m,index:c.length,penalty:f,rawTime:l,scramble:h,time:l},o=b.extractRawTimes(c);o.push(b.extractRawTimes([n])[0]),n=d.populateAverages(o,n,n.index,j);var p=b.convertTimeFromStringToMilliseconds(e);switch(f){case"+2":n.displayedTime=b.convertTimeFromMillisecondsToString(b.convertTimeFromStringToMilliseconds(e)+2e3,j)+"+",n.detailedTime=n.displayedTime,p+="+";break;case"DNF":n.displayedTime="DNF",n.detailedTime="DNF("+b.convertTimeFromMillisecondsToString(b.convertTimeFromStringToMilliseconds(e),j)+")",p+="-"}c.push(n);var q=a.getJSON(i);q.results.push(p+"|"+(k?h:"")+"|"+Date.now()+(""!==g?"|"+g:"")),a.setJSON(i,q)},d.populateAverages=function(a,c,d,e){return d>=4?c.avg5=b.calculateAverageString(a.slice(d-4,d+1),!0,e):c.avg5="DNF",d>=11?c.avg12=b.calculateAverageString(a.slice(d-11,d+1),!0,e):c.avg12="DNF",c},d.penalty=function(d,e,f,g,h){var i=a.getJSON(e),j=i.results[f],k=j.substring(j.indexOf("|")-1,j.indexOf("|"));switch(g){case"":d.penalty="",d.rawTime=d.time,d.displayedTime=b.convertTimeFromMillisecondsToString(d.time,h),d.detailedTime=d.displayedTime,("+"===k||"-"===k)&&(j=j.substring(0,j.indexOf("|")-1)+j.substring(j.indexOf("|"),j.length));break;case"+2":d.penalty="+2",d.rawTime=d.time+2e3,d.displayedTime=b.convertTimeFromMillisecondsToString(d.time+2e3,h)+"+",d.detailedTime=d.displayedTime,j="+"===k||"-"===k?j.substring(0,j.indexOf("|")-1)+"+"+j.substring(j.indexOf("|"),j.length):j.substring(0,j.indexOf("|"))+"+"+j.substring(j.indexOf("|"),j.length);break;case"DNF":d.penalty="DNF",d.rawTime=c.DNF,d.displayedTime="DNF",d.detailedTime="DNF("+b.convertTimeFromMillisecondsToString(d.time,h)+")",j="+"===k||"-"===k?j.substring(0,j.indexOf("|")-1)+"-"+j.substring(j.indexOf("|"),j.length):j.substring(0,j.indexOf("|"))+"-"+j.substring(j.indexOf("|"),j.length)}i.results[f]=j,a.setJSON(e,i)},d.remove=function(b,c,d){b.splice(d,1);var e=a.getJSON(c);e.results.splice(d,1),a.setJSON(c,e)},d.comment=function(b,c,d,e){b.comment=e;var f=a.getJSON(c),g=f.results[d].split("|");""!==e?g[3]?(g[3]=e,f.results[d]=g.join("|")):f.results[d]=f.results[d]+"|"+e:g[3]&&(g.splice(3,1),f.results[d]=g.join("|")),a.setJSON(c,f)}}angular.module("results").service("ResultsService",["LocalStorage","Calculator","Constants",a])}(),function(){"use strict";function a(a,b,c,d){var e=this;e.results=d.getModalResults(b,c),e.type=3===b.length?"mean":"average",e.close=function(){a.dismiss()}}angular.module("results").controller("ResultsModalController",["$modalInstance","results","precision","ResultsModalService",a])}(),function(){"use strict";function a(a){var b=this;b.getModalResults=function(b,c){var d=a.extractRawTimes(b);return 3!==d.length&&(b[d.indexOf(Math.min.apply(null,d))].min=!0,b[d.indexOf(Math.max.apply(null,d))].max=!0),{results:b,avg:a.calculateAverageString(d,3!==d.length,c),stDev:a.calculateStandardDeviationString(d,3!==d.length,c)}}}angular.module("results").service("ResultsModalService",["Calculator",a])}(),function(){"use strict";function a(a,b,c){function d(d,e){a.insidePopover=-1,$(e).popover({animation:!1,content:c.get("resultsPopover.html"),html:!0,placement:"right",title:d.ctrl.result.detailedTime}),$(e).bind("mouseenter",function(){d.ctrl.insideDiv=d.ctrl.index,b(function(){$(e).popover("show"),d.ctrl.attachEvents(e)},1)}),$(e).bind("mouseleave",function(){d.ctrl.insideDiv=-1,b(function(){a.insidePopover!==d.ctrl.index&&$(e).popover("hide")},1)})}return{restrict:"E",scope:{index:"=",precision:"=",result:"=",results:"=",sessionId:"="},controller:"ResultsPopoverController",controllerAs:"ctrl",bindToController:!0,link:d}}angular.module("results").directive("resultsPopover",["$rootScope","$timeout","$templateCache",a])}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.attachEvents=function(g){$(".popover").on("mouseenter",function(){b.insidePopover=f.index}).on("mouseleave",function(){b.insidePopover=-1,c(function(){f.insideDiv!==f.index&&$(g).popover("hide")},1)}),$(".popover-btn-penalty-ok").on("click",function(){d.penalty(f.result,f.sessionId,f.index,"",f.precision),a.$apply(),b.$broadcast("refresh statistics"),$(g).popover("hide")}),$(".popover-btn-penalty-plus").on("click",function(){d.penalty(f.result,f.sessionId,f.index,"+2",f.precision),a.$apply(),b.$broadcast("refresh statistics"),$(g).popover("hide")}),$(".popover-btn-penalty-dnf").on("click",function(){d.penalty(f.result,f.sessionId,f.index,"DNF",f.precision),a.$apply(),b.$broadcast("refresh statistics"),$(g).popover("hide")}),$(".popover-btn-remove").on("click",function(){confirm("Are you sure you want to delete this time?")&&(d.remove(f.results,f.sessionId,f.index),a.$apply(),$(g).popover("hide"))}),$(".popover-input-comment").on("focus",function(){b.isTypingComment=!0}).on("blur",function(){c(function(){b.isTypingComment=!1},1)}).on("keydown",function(b){b.keyCode===e.KEY_CODES.ENTER&&(d.comment(f.result,f.sessionId,f.index,$(".popover-input-comment")[0].value),a.$apply(),$(g).popover("hide"))})[0].value=f.result.comment}}angular.module("results").controller("ResultsPopoverController",["$scope","$rootScope","$timeout","ResultsService","Constants",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/scramble/scramble.html",controller:"ScrambleController",controllerAs:"ctrl",scope:{eventId:"=",scramble:"="},bindToController:!0}}angular.module("scramble",[]).directive("scramble",a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this;a.$on("new scramble",function(a,g){f.scramble=d.getNewScramble(g),f.displayedScramble=c.trustAsHtml(f.scramble),f.scrambleStyle=e.getEventStyle(g),b.$broadcast("draw scramble",g,d.getScrambleState())})}angular.module("scramble").controller("ScrambleController",["$scope","$rootScope","$sce","ScrambleService","Events",a])}(),function(){"use strict";function a(){var a=this;a.getScrambleState=function(){return a.scramble.state},a.getNewScramble=function(b){return a.scramble=scramblers[b].getRandomScramble()," "===a.scramble.scramble_string.substring(a.scramble.scramble_string.length-1,a.scramble.scramble_string.length)?a.scramble.scramble_string.substring(0,a.scramble.scramble_string.length-1):a.scramble.scramble_string}}angular.module("scramble").service("ScrambleService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;g.settings=f.SETTINGS;for(var h=0;h<g.settings.length;h++)g.settings[h].value=d[g.settings[h].id];a.$on("keydown",function(a,b){switch(b.keyCode){case f.KEY_CODES.ENTER:g.save();break;case f.KEY_CODES.ESCAPE:g.close()}}),g.save=function(){for(var a=0;a<g.settings.length;a++)d[g.settings[a].id]=g.settings[a].value;e.saveSettings(d),c.dismiss(),b.$broadcast("refresh settings"),b.$broadcast("refresh results")},g.resetSettings=function(){confirm("Are you sure you want to reset all settings?")&&(d=e.resetSettings(),b.$broadcast("refresh settings"),c.dismiss())},g.close=function(){c.dismiss()}}angular.module("menuBar").controller("SettingsController",["$scope","$rootScope","$modalInstance","settings","MenuBarService","Constants",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/statistics/statistics.html",controller:"StatisticsController",controllerAs:"ctrl",scope:{results:"=",settings:"="},bindToController:!0}}angular.module("statistics",[]).directive("statistics",a)}(),function(){"use strict";function a(a,b,c){var d=this;a.$watchCollection(function(){return d.results},function(){d.statistics=c.getStatistics(d.results,d.settings.statisticsPrecision)}),a.$on("refresh statistics",function(){d.statistics=c.getStatistics(d.results,d.settings.statisticsPrecision)}),d.openModal=function(a,c){var e=d.statistics.averages[c].length,f="best"===a?d.statistics.averages[c].best.index:d.results.length-e;b.open({animation:!0,templateUrl:"dist/components/gjTimer/resultsModal/resultsModal.html",controller:"ResultsModalController",controllerAs:"ctrl",size:"lg",resolve:{results:function(){return d.results.slice(f,f+e)},precision:function(){return d.settings.resultsPrecision}}})}}angular.module("statistics").controller("StatisticsController",["$scope","$uibModal","StatisticsService",a])}(),function(){"use strict";function a(a){var b=this;b.getStatistics=function(b,c){var d=a.extractRawTimes(b),e={solves:{attempted:d.length,solved:a.countNonDNFs(d),best:a.convertTimeFromMillisecondsToString(Math.min.apply(null,d),c),worst:a.convertTimeFromMillisecondsToString(Math.max.apply(null,d),c)},sessionMean:a.calculateSessionMeanAndStandardDeviationString(d,c),sessionAvg:{avg:a.calculateAverageString(d,!0,c),stDev:a.calculateStandardDeviationString(d,!0,c)},averages:[]};d.length>=3&&e.averages.push({type:"m",length:3,current:{avg:a.calculateAverageString(d.slice(d.length-3,d.length),!1,c),stDev:a.calculateStandardDeviationString(d.slice(d.length-3,d.length),!1,c)},best:a.calculateBestAverageAndStandardDeviationString(d,!1,3,c)});for(var f=[5,12,50,100],g=0;g<f.length;g++)d.length>=f[g]&&e.averages.push({type:"a",length:f[g],current:{avg:a.calculateAverageString(d.slice(d.length-f[g],d.length),!0,c),stDev:a.calculateStandardDeviationString(d.slice(d.length-f[g],d.length),!0,c)},best:a.calculateBestAverageAndStandardDeviationString(d,!0,f[g],c)});return e}}angular.module("statistics").service("StatisticsService",["Calculator",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/timer/timer.html",controller:"TimerController",controllerAs:"ctrl",scope:{eventId:"=",results:"=",scramble:"=",sessionId:"=",settings:"="},bindToController:!0}}angular.module("timer",[]).directive("timer",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h,i,j=this,k="reset",l="",m="",n="",o=j.settings.timerPrecision;a.$on("refresh settings",function(){j.refreshSettings()}),a.$on("keydown",function(a,b){"Timer"===j.settings.input&&(j.settings.inspection?"reset"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.prepareInspection():"inspecting"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR&&j.prepareTimerWIthInspection():"reset"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.prepareTimer():"memorizing"===k?j.saveMemorizationTime():"timing"===k&&j.stopTimer())}),a.$on("keyup",function(a,b){"Timer"===j.settings.input&&(j.settings.inspection?"pre inspection"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.startInspection():"pre timing"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?(j.stopInspection(),j.startTimer()):j.resetTimer():"ready"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.startTimer():"execution"==k?j.startExecutionTime():j.resetTimer())}),j.prepareTimer=function(){k="keydown",j.time=2===o?"0.00":"0.000",0!==j.settings.timerStartDelay&&(j.timerStyle=g.STYLES.COLOR.ORANGE),d(function(){"keydown"===k&&(k="ready",j.timerStyle=g.STYLES.COLOR.GREEN,b.$broadcast("timer focus"))},j.settings.timerStartDelay)},j.startTimer=function(){j.settings.bldMode&&!j.settings.inspection?(k="memorizing",j.timerStyle=g.STYLES.COLOR.BLUE):(k="timing",j.timerStyle=g.STYLES.COLOR.BLACK),e.startTimer(),h=c(function(){j.time=e.getTime(o)},j.settings.timerRefreshInterval)},j.stopTimer=function(){k="stopped",j.time=e.getTime(o),c.cancel(h),m=j.settings.bldMode?e.createCommentForBldMode(j.time,n):"",f.saveResult(j.results,j.time,l,m,j.scramble,j.sessionId,j.settings.resultsPrecision,j.settings.saveScramble),b.$broadcast("new scramble",j.eventId)},j.prepareInspection=function(){k="pre inspection",j.timerStyle=g.STYLES.COLOR.ORANGE,j.time="15",b.$broadcast("timer focus")},j.startInspection=function(){k="inspecting",j.timerStyle=g.STYLES.COLOR.BLUE,e.startInspection(),i=c(function(){var a=e.getInspectionTime();a>0?j.time=a:a>-2?(j.timerStyle!==g.STYLES.COLOR.ORANGE&&(j.timerStyle=g.STYLES.COLOR.RED),j.time="+2",l="+2"):(j.time="DNF",l="DNF")},1e3)},j.prepareTimerWIthInspection=function(){k="pre timing",j.timerStyle=g.STYLES.COLOR.ORANGE},j.stopInspection=function(){c.cancel(i)},j.saveMemorizationTime=function(){k="execution",j.timerStyle=g.STYLES.COLOR.BLACK,n=j.time},j.startExecutionTime=function(){k="timing"},j.resetTimer=function(){j.timerStyle=g.STYLES.COLOR.BLACK,b.$broadcast("timer unfocus"),("keydown"===k||"stopped"===k)&&(k="reset"),l="",n="",m=""},j.submitInput=function(){""===j.time?b.$broadcast("new scramble",j.eventId):a.input.text.$valid&&(f.saveResult(j.results,j.time,l,m,j.scramble,j.sessionId,j.settings.resultsPrecision,j.settings.saveScramble),j.time="",b.$broadcast("new scramble",j.eventId))},j.refreshSettings=function(){"Timer"===j.settings.input?j.time=j.settings.inspection?"15":2===o?"0.00":"0.000":"Typing"===j.settings.input&&(j.time="")},j.refreshSettings()}angular.module("timer").controller("TimerController",["$scope","$rootScope","$interval","$timeout","TimerService","ResultsService","Constants",a])}(),function(){"use strict";function a(a,b){var c=this;c.getTime=function(a){return b.convertTimeFromMillisecondsToString(moment(Date.now()-c.startTime),a)},c.getInspectionTime=function(){return Math.ceil((15e3+c.inspectionStartTime-Date.now())/1e3)},c.startTimer=function(){c.startTime=Date.now()},c.startInspection=function(){c.inspectionStartTime=Date.now()},c.createCommentForBldMode=function(a,c){var d=b.convertTimeFromStringToMilliseconds(a),e=b.convertTimeFromStringToMilliseconds(c),f=b.convertTimeFromMillisecondsToString(d-e);return"memo: "+c+", exe: "+f}}angular.module("timer").service("TimerService",["LocalStorage","Calculator",a])}();