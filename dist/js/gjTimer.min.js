!function(){"use strict";function a(){}function b(a,b){a.get("dist/components/gjTimer/resultsPopover/resultsPopover.html").success(function(a){b.put("resultsPopover.html",a)})}angular.module("gjTimerApp",["angular-spinkit","ui.bootstrap","chart.js","gjTimer"]),angular.module("gjTimerApp").config(a).run(["$http","$templateCache",b])}(),function(){"use strict";angular.module("gjTimer.services",[]),angular.module("gjTimer.filters",[]),angular.module("gjTimer",["gjTimer.services","gjTimer.filters","charts","cub","menuBar","results","scramble","statistics","timer"])}(),function(){"use strict";function a(a,b,c){b.isTyping=!1,a.style={},a.keydown=function(d){b.isTypingComment||(event.keyCode!==c.KEY_CODES.ENTER||b.isTyping?event.keyCode===c.KEY_CODES.SPACE_BAR&&event.preventDefault():b.$broadcast("new scramble",a.eventId),b.$broadcast("keydown",d))},a.keyup=function(a){b.isTypingComment||b.$broadcast("keyup",a)},a.$on("timer focus",function(){a.style.body=a.settings.backgroundColor,a.settings.backgroundColor=a.settings.panelColor,a.style.section={display:"none"},a.style.timer={"margin-top":"2.9375em"}}),a.$on("timer unfocus",function(){a.style.body&&(a.settings.backgroundColor=a.style.body),a.style.section={display:"block"},a.style.timer={}})}angular.module("gjTimer").controller("gjTimerController",["$scope","$rootScope","Constants",a])}(),function(){"use strict";function a(){return function(a){return void 0!==a?a.slice().reverse():[]}}angular.module("gjTimer.filters").filter("reverse",a)}(),function(){"use strict";function a(a){var b=this;b.calculateAverage=function(b,c){var d=b.slice(0);return c&&(d.splice(d.indexOf(Math.min.apply(null,d)),1),d.splice(d.indexOf(Math.max.apply(null,d)),1)),d.indexOf(a.DNF)>=0||0===d.length?a.DNF:Number((d.reduce(function(a,b){return a+b},0)/d.length).toFixed())},b.calculateAverageString=function(a,c,d){return b.convertTimeFromMillisecondsToString(b.calculateAverage(a,c),d)},b.calculateStandardDeviation=function(c,d){var e=c.slice(0);if(d&&(e.splice(e.indexOf(Math.min.apply(null,e)),1),e.splice(e.indexOf(Math.max.apply(null,e)),1)),e.indexOf(a.DNF)>=0||0===e.length)return a.DNF;var f=b.calculateAverage(e,!1),g=e.map(function(a){return Math.pow(a-f,2)});return Number(Math.sqrt(b.calculateAverage(g,!1)).toFixed())},b.calculateStandardDeviationString=function(a,c,d){return b.convertTimeFromMillisecondsToString(b.calculateStandardDeviation(a,c),d)},b.calculateSessionMeanAndStandardDeviationString=function(c,d){var e=c.slice(0).filter(function(b){return b!==a.DNF});return{mean:b.calculateAverageString(e,!1,d),stDev:b.calculateStandardDeviationString(e,!1,d)}},b.calculateBestAverageAndStandardDeviationString=function(c,d,e,f){for(var g,h=a.DNF,i=-1,j=0;j<=c.length-e;j++)g=b.calculateAverage(c.slice(j,j+e),d),h>g&&(h=g,i=j);return{index:i,avg:b.convertTimeFromMillisecondsToString(h,f),stDev:b.calculateStandardDeviationString(c.slice(i,i+e),d,f)}},b.extractRawTimes=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].rawTime);return b},b.countNonDNFs=function(b){return b.slice(0).filter(function(b){return b!==a.DNF}).length},b.convertTimeFromStringToMilliseconds=function(b){if("DNF"===b)return a.DNF;var c=b.split(":");return 1===c.length?Number((1e3*parseFloat(c[0])).toFixed()):2===c.length?Number((60*parseFloat(c[0])*1e3+1e3*parseFloat(c[1])).toFixed()):3===c.length?Number((60*parseFloat(c[0])*60*1e3+60*parseFloat(c[1])*1e3+1e3*parseFloat(c[2])).toFixed()):a.DNF},b.convertTimeFromMillisecondsToString=function(b,c){if(b===a.DNF||0>b||b===1/0)return"DNF";var d,e=moment(b);switch(c){case 0:d="";break;case 1:d=".S";break;case 2:d=".SS";break;case 3:d=".SSS";break;default:d=".SS"}return 1e4>b?e.format("s"+d):6e4>b?e.format("ss"+d):36e5>b?e.format("m:ss"+d):e.utc().format("H:mm:ss"+d)}}angular.module("gjTimer.services").service("Calculator",["Constants",a])}(),function(){"use strict";function a(){var a=this;a.DEFAULT_NUMBER_OF_SESSIONS=15,a.NUM_RESULTS_DISPLAYED=50,a.DNF=864e6,a.TIMER_REFRESH_INTERVAL=50,a.KEY_CODES={ENTER:13,ESCAPE:27,SPACE_BAR:32},a.COLORS={BLACK:"#000000",RED:"#FF0000",ORANGE:"#FFA500",GREEN:"#2EB82E",BLUE:"#0000FF",GRAY:"#EEEEEE",WHITE:"#FFFFFF"},a.STYLES={COLOR:{BLACK:{color:a.COLORS.BLACK},RED:{color:a.COLORS.RED},ORANGE:{color:a.COLORS.ORANGE},GREEN:{color:a.COLORS.GREEN},BLUE:{color:a.COLORS.BLUE}},BACKGROUND_COLOR:{GRAY:{"background-color":a.COLORS.GRAY},WHITE:{"background-color":a.COLORS.WHITE}}};var b=[{value:{"background-color":"#FFFFFF"}},{value:{"background-color":"#EEEEEE"}},{value:{"background-color":"#FFE5EE"}},{value:{"background-color":"#FFCCCC"}},{value:{"background-color":"#FFE8D2"}},{value:{"background-color":"#FFFFCC"}},{value:{"background-color":"#D7FFD7"}},{value:{"background-color":"#E5F5FF"}},{value:{"background-color":"#FFE5FF"}},{value:{"background-color":"#F1E3D4"}}];a.DEFAULT_SETTINGS={input:"Timer",inspection:!1,bldMode:!1,timerPrecision:3,timerStartDelay:0,showScramble:!0,showCharts:!0,saveScramble:!0,resultsPrecision:2,statisticsPrecision:3,panelColor:{"background-color":"#EEEEEE"},backgroundColor:{"background-color":"#FFFFFF"}},a.SETTINGS=[{id:"input",title:"Input",options:[{value:"Timer",text:"Timer"},{value:"Typing",text:"Typing"}]},{id:"inspection",title:"Inspection",options:[{value:!0,text:"On"},{value:!1,text:"Off"}]},{id:"bldMode",title:"BLD Mode",options:[{value:!0,text:"On"},{value:!1,text:"Off"}]},{id:"timerPrecision",title:"Timer Precision",options:[{value:0,text:"0"},{value:1,text:"0.1"},{value:2,text:"0.01"},{value:3,text:"0.001"}]},{id:"timerStartDelay",title:"Timer Start Delay",options:[{value:0,text:"0"},{value:300,text:"0.3"},{value:550,text:"0.55"}]},{id:"showScramble",title:"Show Scramble",options:[{value:!0,text:"Yes"},{value:!1,text:"No"}]},{id:"showCharts",title:"Show Charts",options:[{value:!0,text:"Yes"},{value:!1,text:"No"}]},{id:"saveScramble",title:"Save Scramble",options:[{value:!0,text:"Yes"},{value:!1,text:"No"}]},{id:"resultsPrecision",title:"Results Precision",options:[{value:2,text:"0.01"},{value:3,text:"0.001"}]},{id:"statisticsPrecision",title:"Stats Precision",options:[{value:2,text:"0.01"},{value:3,text:"0.001"}]},{id:"panelColor",title:"Panel Color",options:b},{id:"backgroundColor",title:"Background Color",options:b}]}angular.module("gjTimer.services").service("Constants",a)}(),function(){"use strict";function a(){var a=this;a.events={333:{index:0,name:"Rubik's Cube",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},444:{index:1,name:"4x4 Cube",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},555:{index:2,name:"5x5 Cube",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},222:{index:3,name:"2x2 Cube",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},"333bf":{index:4,name:"3x3 blindfolded",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},"333oh":{index:5,name:"3x3 one-handed",style:{"font-size":"16pt"},svg:{ratio:.75,width:250}},minx:{index:6,name:"Megaminx",style:{"font-size":"13pt"},svg:{ratio:.51,width:175}},pyram:{index:7,name:"Pyraminx",style:{"font-size":"16pt"},svg:{ratio:.69,width:250}},sq1:{index:8,name:"Square-1",style:{"font-size":"15pt"},svg:{ratio:.57,width:175}},clock:{index:9,name:"Rubik's Clock",style:{"font-size":"15pt"},svg:{ratio:.5,width:175}},666:{index:10,name:"6x6 Cube",style:{"font-size":"13pt"},svg:{ratio:.75,width:250}},777:{index:11,name:"7x7 Cube",style:{"font-size":"13pt"},svg:{ratio:.75,width:250}},"444bf":{index:12,name:"4x4 blindfolded",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}},"555bf":{index:13,name:"5x5 blindfolded",style:{"font-size":"15pt"},svg:{ratio:.75,width:250}}},a.getEvents=function(){var b=[];return angular.forEach(a.events,function(a){b[a.index]=a.name}),b},a.getEvent=function(b){return a.events.hasOwnProperty(b)?a.events[b].name:null},a.getEventId=function(b){for(var c in a.events)if(a.events.hasOwnProperty(c)&&a.events[c].name===b)return c;return null},a.getEventStyle=function(b){return a.events.hasOwnProperty(b)?a.events[b].style:a.events[333].style},a.getEventSvg=function(b){return a.events.hasOwnProperty(b)?a.events[b].svg:a.events[333].svg}}angular.module("gjTimer.services").service("Events",a)}(),function(){"use strict";function a(a,b){var c=this;c.get=function(a){return localStorage.getItem(a)},c.set=function(a,b){try{return localStorage.setItem(a,b),!0}catch(c){return!1}},c.getJSON=function(a){var b=localStorage.getItem(a);return null!==b?JSON.parse(b):null},c.getJSONAsync=function(c){return a(function(a){b(function(){var b=localStorage.getItem(c);a(null!==b?JSON.parse(b):null)},0)})},c.setJSON=function(a,b){try{return localStorage.setItem(a,JSON.stringify(b)),!0}catch(c){return!1}},c.setJSONAsync=function(c,d){return a(function(a,e){b(function(){try{localStorage.setItem(c,JSON.stringify(d)),a()}catch(b){e(b)}},0)})},c.clear=function(){try{return localStorage.clear(),!0}catch(a){return!1}}}angular.module("gjTimer.services").service("LocalStorage",["$q","$timeout",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/charts/charts.html",controller:"ChartsController",controllerAs:"ctrl",scope:{results:"=",settings:"="},bindToController:!0}}angular.module("charts",[]).directive("charts",a)}(),function(){"use strict";function a(a,b){function c(){f.lineChartSeries=d.series,f.lineChartLabels=d.labels,f.lineChartData=d.data,f.barChartLabels=e.labels,f.barChartData=e.data}var d,e,f=this;b.setChartDefaults(),a.$on("refresh results",function(){f.loaded=!1}),a.$on("refresh charts",function(a,g){f.loaded=!1,d=b.initLineChartData(g),e=b.initBarChartData(g),c(),f.loaded=!0}),a.$on("new result",function(a,f){d=b.addLineChartData(d,f),e=b.addBarChartData(e,f),c()})}angular.module("charts").controller("ChartsController",["$scope","ChartsService",a])}(),function(){"use strict";function a(a,b){var c=this;c.initLineChartData=function(c){for(var d,e,f,g=[],h=[[],[],[]],i=0;i<c.length;i++)g.push(c[i].index+1),d=c[i].rawTime,e=a.convertTimeFromStringToMilliseconds(c[i].avg5),f=a.convertTimeFromStringToMilliseconds(c[i].avg12),h[0].push(d!==b.DNF?Number((d/1e3).toFixed(2)):null),h[1].push(e!==b.DNF?e/1e3:null),h[2].push(f!==b.DNF?f/1e3:null);return{series:["Time","Avg 5","Avg 12"],labels:g,data:h}},c.initBarChartData=function(c){var d,e,f={},g=[],h=[];d=a.extractRawTimes(c);for(var i=0;i<d.length;i++)d[i]!==b.DNF&&(e=Math.floor(d[i]/1e3),f.hasOwnProperty(e)?f[e]+=1:f[e]=1);for(var j in f)f.hasOwnProperty(j)&&(g.push(a.convertTimeFromMillisecondsToString(1e3*j,0)),h.push(f[j]));return{labels:g,data:[h]}},c.addLineChartData=function(c,d){var e,f,g;return c.labels.push(d.index+1),e=d.rawTime,f=a.convertTimeFromStringToMilliseconds(d.avg5),g=a.convertTimeFromStringToMilliseconds(d.avg12),c.data[0].push(e!==b.DNF?Number((e/1e3).toFixed(2)):null),c.data[1].push(f!==b.DNF?f/1e3:null),c.data[2].push(g!==b.DNF?g/1e3:null),c},c.addBarChartData=function(c,d){var e,f,g;if(e=a.extractRawTimes([d])[0],e!==b.DNF){if(f=a.convertTimeFromMillisecondsToString(e,0),g=c.labels.indexOf(f),0>g){for(var h=0;h<c.labels.length;h++)if(e<a.convertTimeFromStringToMilliseconds(c.labels[h]))return c.labels.splice(h,0,f),c.data[0].splice(h,0,1),c;return c.labels.push(f),c.data[0].push(1),c}return c.data[0][g]+=1,c}},c.setChartDefaults=function(){Chart.defaults.global.animation=!1,Chart.defaults.global.colours=["#4D5360","#46BFBD","#FDB45C"],Chart.defaults.global.tooltipCornerRadius=2,Chart.defaults.global.tooltipFontSize=12,Chart.defaults.global.tooltipTitleFontSize=12,Chart.defaults.Line.bezierCurve=!1,Chart.defaults.Line.datasetStrokeWidth=1,Chart.defaults.Line.pointDotRadius=0,Chart.defaults.Line.pointHitDetectionRadius=10}}angular.module("charts").service("ChartsService",["Calculator","Constants",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/cub/cub.html",controller:"CubController",controllerAs:"ctrl",scope:{settings:"="},bindToController:!0}}angular.module("cub",[]).directive("cub",a)}(),function(){"use strict";function a(a,b){var c=this;a.$on("draw scramble",function(a,d,e){c.cub=b.drawScramble(d,e)})}angular.module("cub").controller("CubController",["$scope","CubService",a])}(),function(){"use strict";function a(a,b){var c=this;c.drawScramble=function(c,d){var e=b.getEventSvg(c).width,f=e/b.getEventSvg(c).ratio,g=document.createElement("div");scramblers[c].drawScramble(g,d,f,e);var h=document.createElement("div");return h.appendChild(g),a.trustAsHtml(h.innerHTML)}}angular.module("cub").service("CubService",["$sce","Events",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/menuBar/menuBar.html",controller:"MenuBarController",controllerAs:"ctrl",scope:{eventId:"=",results:"=",sessionId:"=",settings:"="},bindToController:!0}}angular.module("menuBar",[]).directive("menuBar",a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.eventId=d.initEvent(),f.sessionId=d.initSession(),f.sessions=d.initSessions(),f.settings=d.initSettings(),f.events=e.getEvents(),f.event={eventId:f.eventId,event:e.getEvent(f.eventId)},f.showDetails=window.innerWidth>500,$(window).resize(function(){f.showDetails=window.innerWidth>500,a.$apply()}),f.changeSession=function(a){f.sessionId=a;var c=d.changeSession(a);c!==f.eventId&&b.$broadcast("new scramble",c),f.eventId=c,b.$broadcast("refresh results",a),f.event={eventId:f.eventId,event:e.getEvent(f.eventId)}},f.changeEvent=function(a){f.eventId=e.getEventId(a),f.event={eventId:f.eventId,event:e.getEvent(f.eventId)},d.changeEvent(f.sessionId,f.eventId),b.$broadcast("new scramble",f.eventId)},f.openSettings=function(){c.open({animation:!0,templateUrl:"dist/components/gjTimer/settings/settings.html",controller:"SettingsController",controllerAs:"ctrl",size:"md",resolve:{settings:function(){return f.settings}}})},f.resetSession=function(){confirm("Are you sure you want to reset "+f.sessionId+"?")&&(f.results=[],d.resetSessionAsync(f.sessionId))}}angular.module("menuBar").controller("MenuBarController",["$scope","$rootScope","$uibModal","MenuBarService","Events",a])}(),function(){"use strict";function a(a,b){var c=this;c.initSettings=function(){var c=a.getJSON("settings");if(null===c)return a.setJSON("settings",b.DEFAULT_SETTINGS),b.DEFAULT_SETTINGS;for(var d in b.DEFAULT_SETTINGS)b.DEFAULT_SETTINGS.hasOwnProperty(d)&&(c.hasOwnProperty(d)||(c[d]=b.DEFAULT_SETTINGS[d],a.setJSON("settings",c)));return c},c.saveSettings=function(b){a.setJSON("settings",b)},c.resetSettings=function(){return a.setJSON("settings",b.DEFAULT_SETTINGS),b.DEFAULT_SETTINGS},c.initSessions=function(){for(var c,d=[],e=1;e<=b.DEFAULT_NUMBER_OF_SESSIONS;e++)d.push("Session "+e),c=a.getJSON("Session "+e),null===c&&a.setJSON("Session "+e,{results:[]});return d},c.initSession=function(){var b=a.get("sessionId");return b?b:(a.set("sessionId","Session 1"),"Session 1")},c.initEvent=function(){var b=a.get("eventId");return b?b:(a.set("eventId","333"),"333")},c.changeSession=function(c){a.set("sessionId",c);var d=a.getJSON("events");if(d)return d.hasOwnProperty(c)?d[c]:(d[c]="333",a.setJSON("events",d),"333");d={};for(var e=1;e<b.DEFAULT_NUMBER_OF_SESSIONS;e++)d["Session "+e]="333";return a.setJSON("events",d),"333"},c.changeEvent=function(c,d){var e=a.getJSON("events");if(!e){e={};for(var f=1;f<b.DEFAULT_NUMBER_OF_SESSIONS;f++)e["Session "+f]="333"}e[c]=d,a.setJSON("events",e),a.set("eventId",d)},c.resetSessionAsync=function(b){return a.getJSONAsync(b).then(function(c){return c.results=[],a.setJSONAsync(b,c)})},c.resetAll=function(){a.clear()}}angular.module("menuBar").service("MenuBarService",["LocalStorage","Constants",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/results/results.html",controller:"ResultsController",controllerAs:"ctrl",scope:{results:"=",sessionId:"=",settings:"="},bindToController:!0}}angular.module("results",[]).directive("results",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(a){g.loaded=!1,d.getResultsAsync(a||g.sessionId,g.settings.resultsPrecision).then(function(a){g.NUM_RESULTS_DISPLAYED=e.NUM_RESULTS_DISPLAYED,g.loaded=!0,g.results=a,g.loaded=!0,b.$broadcast("refresh statistics",a),b.$broadcast("refresh charts",a)})}var g=this;g.NUM_RESULTS_DISPLAYED=e.NUM_RESULTS_DISPLAYED,f(),a.$on("refresh results",function(a,b){f(b)}),g.openModal=function(a,b){a>=b&&c.open({animation:!0,templateUrl:"dist/components/gjTimer/resultsModal/resultsModal.html",controller:"ResultsModalController",controllerAs:"ctrl",size:"lg",resolve:{results:function(){return g.results.slice(a-b,a)},precision:function(){return g.settings.resultsPrecision}}})}}angular.module("results").controller("ResultsController",["$scope","$rootScope","$uibModal","ResultsService","Constants",a])}(),function(){"use strict";function a(a,b,c,d,e){function f(a,b){for(var c=d.extractRawTimes(a),e=0;e<a.length;e++)a[e].avg5=e>5?d.calculateAverageString(c.slice(e-4,e+1),!0,b):"DNF",a[e].avg12=e>12?d.calculateAverageString(c.slice(e-11,e+1),!0,b):"DNF"}var g=this;g.getResultsAsync=function(a,b){return c.getJSONAsync(a).then(function(a){for(var c,g,h,i=[],j=a.results,k=0;k<j.length;k++)g=j[k].split("|"),c={index:k,scramble:g[1],date:new Date(Number(g[2])),comment:g[3]?g[3]:""},h=g[0].substring(g[0].length-1,g[0].length),"+"===h?(c.time=Number(g[0].substring(0,g[0].length-1)),c.penalty="+2",c.rawTime=Number((c.time+2e3).toFixed()),c.displayedTime=d.convertTimeFromMillisecondsToString(Number(g[0].substring(0,g[0].length-1))+2e3,b)+"+",c.detailedTime=c.displayedTime):"-"===h?(c.time=Number(g[0].substring(0,g[0].length-1)),c.penalty="DNF",c.rawTime=e.DNF,c.displayedTime="DNF",c.detailedTime="DNF("+d.convertTimeFromMillisecondsToString(Number(g[0].substring(0,g[0].length-1)),b)+")"):(c.time=Number(g[0]),c.penalty="",c.rawTime=c.time,c.displayedTime=d.convertTimeFromMillisecondsToString(Number(g[0]),b),c.detailedTime=c.displayedTime),i.push(c);return f(i,b),i})},g.saveResultAsync=function(e,g,h,i,j,k,l,m){return a(function(a,n){b(function(){var b=d.convertTimeFromStringToMilliseconds(g),o=d.convertTimeFromMillisecondsToString(b,l),p={comment:i,date:new Date,detailedTime:o,displayedTime:o,index:e.length,penalty:h,rawTime:b,scramble:j,time:b},q=d.convertTimeFromStringToMilliseconds(g);switch(h){case"+2":p.displayedTime=d.convertTimeFromMillisecondsToString(d.convertTimeFromStringToMilliseconds(g)+2e3,l)+"+",p.detailedTime=p.displayedTime,q+="+";break;case"DNF":p.displayedTime="DNF",p.detailedTime="DNF("+d.convertTimeFromMillisecondsToString(d.convertTimeFromStringToMilliseconds(g),l)+")",q+="-"}e.push(p),f(e,l),c.getJSONAsync(k).then(function(a){a.results.push(q+"|"+(m?j:"")+"|"+Date.now()+(""!==i?"|"+i:"")),c.setJSONAsync(k,a)["catch"](function(a){n(a)})}),a(p)},0)})},g.penaltyAsync=function(a,b,g,h,i){switch(a[b].penalty=h,h){case"":a[b].rawTime=a[b].time,a[b].displayedTime=d.convertTimeFromMillisecondsToString(a[b].time,i),a[b].detailedTime=a[b].displayedTime;break;case"+2":a[b].rawTime=a[b].time+2e3,a[b].displayedTime=d.convertTimeFromMillisecondsToString(a[b].time+2e3,i)+"+",a[b].detailedTime=a[b].displayedTime;break;case"DNF":a[b].rawTime=e.DNF,a[b].displayedTime="DNF",a[b].detailedTime="DNF("+d.convertTimeFromMillisecondsToString(a[b].time,i)+")"}return f(a,i),c.getJSONAsync(g).then(function(a){var d=a.results[b],e=d.substring(d.indexOf("|")-1,d.indexOf("|"));switch(h){case"":("+"===e||"-"===e)&&(d=d.substring(0,d.indexOf("|")-1)+d.substring(d.indexOf("|"),d.length));break;case"+2":d="+"===e||"-"===e?d.substring(0,d.indexOf("|")-1)+"+"+d.substring(d.indexOf("|"),d.length):d.substring(0,d.indexOf("|"))+"+"+d.substring(d.indexOf("|"),d.length);break;case"DNF":d="+"===e||"-"===e?d.substring(0,d.indexOf("|")-1)+"-"+d.substring(d.indexOf("|"),d.length):d.substring(0,d.indexOf("|"))+"-"+d.substring(d.indexOf("|"),d.length)}return a.results[b]=d,c.setJSONAsync(g,a)})},g.removeAsync=function(a,b,d,e){a.splice(b,1);for(var g=0;g<a.length;g++)a[g].index=g;return f(a,e),c.getJSONAsync(d).then(function(a){a.results.splice(b,1),c.setJSONAsync(d,a)["catch"](function(a){reject(a)})})},g.commentAsync=function(a,b,d,e){return a[b].comment=e,c.getJSONAsync(d).then(function(a){var f=a.results[b].split("|");""!==e?f[3]?(f[3]=e,a.results[b]=f.join("|")):a.results[b]=a.results[b]+"|"+e:f[3]&&(f.splice(3,1),a.results[b]=f.join("|")),c.setJSONAsync(d,a)["catch"](function(a){reject(a)})})}}angular.module("results").service("ResultsService",["$q","$timeout","LocalStorage","Calculator","Constants",a])}(),function(){"use strict";function a(a,b,c,d){var e=this;e.results=d.getModalResults(b,c),e.type=3===b.length?"mean":"average",e.close=function(){a.dismiss()}}angular.module("results").controller("ResultsModalController",["$uibModalInstance","results","precision","ResultsModalService",a])}(),function(){"use strict";function a(a){var b=this;b.getModalResults=function(b,c){var d=a.extractRawTimes(b);return 3!==d.length&&(b[d.indexOf(Math.min.apply(null,d))].min=!0,b[d.indexOf(Math.max.apply(null,d))].max=!0),{results:b,avg:a.calculateAverageString(d,3!==d.length,c),stDev:a.calculateStandardDeviationString(d,3!==d.length,c)}}}angular.module("results").service("ResultsModalService",["Calculator",a])}(),function(){"use strict";function a(a,b,c){function d(d,e){a.insidePopover=-1,$(e).popover({animation:!1,content:c.get("resultsPopover.html"),html:!0,placement:"right",title:d.ctrl.results[d.ctrl.index].detailedTime}),$(e).bind("mouseenter",function(){d.ctrl.insideDiv=d.ctrl.index,b(function(){$(e).popover("show"),d.ctrl.attachEvents(e)},1)}),$(e).bind("mouseleave",function(){d.ctrl.insideDiv=-1,b(function(){a.insidePopover!==d.ctrl.index&&$(e).popover("hide")},1)})}return{restrict:"E",scope:{index:"=",precision:"=",results:"=",sessionId:"="},controller:"ResultsPopoverController",controllerAs:"ctrl",bindToController:!0,link:d}}angular.module("results").directive("resultsPopover",["$rootScope","$timeout","$templateCache",a])}(),function(){"use strict";function a(a,b,c,d){var e=this;e.attachEvents=function(f){$(".popover").on("mouseenter",function(){a.insidePopover=e.index}).on("mouseleave",function(){a.insidePopover=-1,b(function(){e.insideDiv!==e.index&&$(f).popover("hide")},1)}),$(".popover-btn-penalty-ok").on("click",function(){""!==e.results[e.index].penalty&&c.penaltyAsync(e.results,e.index,e.sessionId,"",e.precision).then(function(){a.$broadcast("refresh statistics",e.results),a.$broadcast("refresh charts",e.results)}),$(f).popover("hide")}),$(".popover-btn-penalty-plus").on("click",function(){"+2"!==e.results[e.index].penalty&&c.penaltyAsync(e.results,e.index,e.sessionId,"+2",e.precision).then(function(){a.$broadcast("refresh statistics",e.results),a.$broadcast("refresh charts",e.results)}),$(f).popover("hide")}),$(".popover-btn-penalty-dnf").on("click",function(){"DNF"!==e.results[e.index].penalty&&c.penaltyAsync(e.results,e.index,e.sessionId,"DNF",e.precision).then(function(){a.$broadcast("refresh statistics",e.results),a.$broadcast("refresh charts",e.results)}),$(f).popover("hide")}),$(".popover-btn-remove").on("click",function(){confirm("Are you sure you want to delete this time?")&&(c.removeAsync(e.results,e.index,e.sessionId,e.precision).then(function(){a.$broadcast("refresh statistics",e.results),a.$broadcast("refresh charts",e.results)}),$(f).popover("hide"))}),$(".popover-input-comment").on("focus",function(){a.isTypingComment=!0}).on("blur",function(){b(function(){a.isTypingComment=!1},1)}).on("keydown",function(a){a.keyCode===d.KEY_CODES.ENTER&&($(".popover-input-comment")[0].value!==e.results[e.index].comment&&c.commentAsync(e.results,e.index,e.sessionId,$(".popover-input-comment")[0].value),$(f).popover("hide"))})[0].value=e.results[e.index].comment}}angular.module("results").controller("ResultsPopoverController",["$rootScope","$timeout","ResultsService","Constants",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/scramble/scramble.html",controller:"ScrambleController",controllerAs:"ctrl",scope:{eventId:"=",scramble:"="},bindToController:!0}}angular.module("scramble",[]).directive("scramble",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(a){d.getNewScrambleAsync(a).then(function(f){g.scramble=f,g.displayedScramble=c.trustAsHtml(g.scramble),g.scrambleStyle=e.getEventStyle(a),b.$broadcast("draw scramble",a,d.getScrambleState())})}var g=this;f(g.eventId),a.$on("new scramble",function(a,b){f(b)})}angular.module("scramble").controller("ScrambleController",["$scope","$rootScope","$sce","ScrambleService","Events",a])}(),function(){"use strict";function a(a,b){var c=this;c.getScrambleState=function(){return c.scramble.state},c.getNewScrambleAsync=function(d){return a(function(a){b(function(){c.scramble=scramblers[d].getRandomScramble(),a(" "===c.scramble.scramble_string.substring(c.scramble.scramble_string.length-1,c.scramble.scramble_string.length)?c.scramble.scramble_string.substring(0,c.scramble.scramble_string.length-1):c.scramble.scramble_string)},0)})}}angular.module("scramble").service("ScrambleService",["$q","$timeout",a])}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;g.settings=f.SETTINGS;for(var h=0;h<g.settings.length;h++)g.settings[h].value=d[g.settings[h].id];a.$on("keydown",function(a,b){switch(b.keyCode){case f.KEY_CODES.ENTER:g.save();break;case f.KEY_CODES.ESCAPE:g.close()}}),g.save=function(){for(var a=0;a<g.settings.length;a++)d[g.settings[a].id]=g.settings[a].value;e.saveSettings(d),c.dismiss(),b.$broadcast("refresh settings"),b.$broadcast("refresh results")},g.resetSettings=function(){confirm("Are you sure you want to reset all settings?")&&(d=e.resetSettings(),b.$broadcast("refresh settings"),c.dismiss())},g.close=function(){c.dismiss()}}angular.module("menuBar").controller("SettingsController",["$scope","$rootScope","$modalInstance","settings","MenuBarService","Constants",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/statistics/statistics.html",controller:"StatisticsController",controllerAs:"ctrl",scope:{results:"=",settings:"="},bindToController:!0}}angular.module("statistics",[]).directive("statistics",a)}(),function(){"use strict";function a(a,b,c){var d=this;a.$on("refresh results",function(){d.loaded=!1}),a.$on("refresh statistics",function(a,b){d.loaded=!1,c.getStatisticsAsync(b,d.settings.statisticsPrecision).then(function(a){d.statistics=a,d.loaded=!0})}),d.openModal=function(a,c){var e=d.statistics.averages[c].length,f="best"===a?d.statistics.averages[c].best.index:d.results.length-e;b.open({animation:!0,templateUrl:"dist/components/gjTimer/resultsModal/resultsModal.html",controller:"ResultsModalController",controllerAs:"ctrl",size:"lg",resolve:{results:function(){return d.results.slice(f,f+e)},precision:function(){return d.settings.resultsPrecision}}})}}angular.module("statistics").controller("StatisticsController",["$scope","$uibModal","StatisticsService",a])}(),function(){"use strict";function a(a,b,c){var d=this;d.getStatisticsAsync=function(d,e){return a(function(a){b(function(){var b=c.extractRawTimes(d),f={solves:{attempted:b.length,solved:c.countNonDNFs(b),best:c.convertTimeFromMillisecondsToString(Math.min.apply(null,b),e),worst:c.convertTimeFromMillisecondsToString(Math.max.apply(null,b),e)},sessionMean:c.calculateSessionMeanAndStandardDeviationString(b,e),sessionAvg:{avg:c.calculateAverageString(b,!0,e),stDev:c.calculateStandardDeviationString(b,!0,e)},averages:[]};b.length>=3&&f.averages.push({type:"m",length:3,current:{avg:c.calculateAverageString(b.slice(b.length-3,b.length),!1,e),stDev:c.calculateStandardDeviationString(b.slice(b.length-3,b.length),!1,e)},best:c.calculateBestAverageAndStandardDeviationString(b,!1,3,e)});for(var g=[5,12,50,100],h=0;h<g.length;h++)b.length>=g[h]&&f.averages.push({type:"a",length:g[h],current:{avg:c.calculateAverageString(b.slice(b.length-g[h],b.length),!0,e),stDev:c.calculateStandardDeviationString(b.slice(b.length-g[h],b.length),!0,e)},best:c.calculateBestAverageAndStandardDeviationString(b,!0,g[h],e)});a(f)},0)})}}angular.module("statistics").service("StatisticsService",["$q","$timeout","Calculator",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"dist/components/gjTimer/timer/timer.html",controller:"TimerController",controllerAs:"ctrl",scope:{eventId:"=",results:"=",scramble:"=",sessionId:"=",settings:"="},bindToController:!0}}angular.module("timer",[]).directive("timer",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h,i,j=this,k="reset",l="",m="",n="",o=j.settings.timerPrecision;a.$on("refresh settings",function(){j.refreshSettings()}),a.$on("keydown",function(a,b){"Timer"===j.settings.input&&(j.settings.inspection?"reset"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.prepareInspection():"inspecting"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR&&j.prepareTimerWIthInspection():"reset"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.prepareTimer():"memorizing"===k?j.saveMemorizationTime():"timing"===k&&j.stopTimer())}),a.$on("keyup",function(a,b){"Timer"===j.settings.input&&(j.settings.inspection?"pre inspection"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.startInspection():"pre timing"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?(j.stopInspection(),j.startTimer()):j.resetTimer():"ready"===k&&b.keyCode===g.KEY_CODES.SPACE_BAR?j.startTimer():"execution"==k?j.startExecutionTime():j.resetTimer())}),j.prepareTimer=function(){k="keydown",j.time=2===o?"0.00":"0.000",0!==j.settings.timerStartDelay&&(j.timerStyle=g.STYLES.COLOR.ORANGE),d(function(){"keydown"===k&&(k="ready",j.timerStyle=g.STYLES.COLOR.GREEN,b.$broadcast("timer focus"))},j.settings.timerStartDelay)},j.startTimer=function(){j.settings.bldMode&&!j.settings.inspection?(k="memorizing",j.timerStyle=g.STYLES.COLOR.BLUE):(k="timing",j.timerStyle=g.STYLES.COLOR.BLACK),e.startTimer(),h=c(function(){j.time=e.getTime(o)},g.TIMER_REFRESH_INTERVAL)},j.stopTimer=function(){k="stopped",j.time=e.getTime(o),c.cancel(h),m=j.settings.bldMode?e.createCommentForBldMode(j.time,n):"",f.saveResultAsync(j.results,j.time,l,m,j.scramble,j.sessionId,j.settings.resultsPrecision,j.settings.saveScramble).then(function(a){b.$broadcast("new result",a),b.$broadcast("refresh statistics",j.results)}),b.$broadcast("new scramble",j.eventId)},j.prepareInspection=function(){k="pre inspection",j.timerStyle=g.STYLES.COLOR.ORANGE,j.time="15",b.$broadcast("timer focus")},j.startInspection=function(){k="inspecting",j.timerStyle=g.STYLES.COLOR.BLUE,e.startInspection(),i=c(function(){var a=e.getInspectionTime();a>0?j.time=a:a>-2?(j.timerStyle!==g.STYLES.COLOR.ORANGE&&(j.timerStyle=g.STYLES.COLOR.RED),j.time="+2",l="+2"):(j.time="DNF",l="DNF")},1e3)},j.prepareTimerWIthInspection=function(){k="pre timing",j.timerStyle=g.STYLES.COLOR.ORANGE},j.stopInspection=function(){c.cancel(i)},j.saveMemorizationTime=function(){k="execution",j.timerStyle=g.STYLES.COLOR.BLACK,n=j.time},j.startExecutionTime=function(){k="timing"},j.resetTimer=function(){j.timerStyle=g.STYLES.COLOR.BLACK,b.$broadcast("timer unfocus"),("keydown"===k||"stopped"===k)&&(k="reset"),l="",n="",m=""},j.submitInput=function(){""===j.time?b.$broadcast("new scramble",j.eventId):a.input.text.$valid&&(f.saveResultAsync(j.results,j.time,l,m,j.scramble,j.sessionId,j.settings.resultsPrecision,j.settings.saveScramble).then(function(a){b.$broadcast("new result",a),b.$broadcast("refresh statistics",j.results),j.time=""}),b.$broadcast("new scramble",j.eventId))},j.refreshSettings=function(){"Timer"===j.settings.input?j.time=j.settings.inspection?"15":2===o?"0.00":"0.000":"Typing"===j.settings.input&&(j.time="")},j.refreshSettings()}angular.module("timer").controller("TimerController",["$scope","$rootScope","$interval","$timeout","TimerService","ResultsService","Constants",a])}(),function(){"use strict";function a(a,b){var c=this;c.getTime=function(a){return b.convertTimeFromMillisecondsToString(moment(Date.now()-c.startTime),a)},c.getInspectionTime=function(){return Math.ceil((15e3+c.inspectionStartTime-Date.now())/1e3);
},c.startTimer=function(){c.startTime=Date.now()},c.startInspection=function(){c.inspectionStartTime=Date.now()},c.createCommentForBldMode=function(a,c){var d=b.convertTimeFromStringToMilliseconds(a),e=b.convertTimeFromStringToMilliseconds(c),f=b.convertTimeFromMillisecondsToString(d-e);return"memo: "+c+", exe: "+f}}angular.module("timer").service("TimerService",["LocalStorage","Calculator",a])}();