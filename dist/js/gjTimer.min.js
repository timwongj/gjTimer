!function(){"use strict";function a(){}function b(){}angular.module("gjTimerApp",["ui.bootstrap","gjTimer"]),angular.module("gjTimerApp").config(a).run(b)}(),function(){"use strict";angular.module("gjTimer",["cub","menuBar","results","scramble","statistics","timer"])}(),function(){"use strict";function a(a,b){var c="#FFFFFF",d="#EEEEEE",e=32,f=13;a.style={body:{},section:{},timer:{}},a.keydown=function(c){c.keyCode===f?b.$broadcast("new scramble",a.event):c.keyCode===e&&c.preventDefault(),b.$broadcast("keydown",c)},a.keyup=function(a){b.$broadcast("keyup",a)},a.$on("timer focus",function(){a.style.body={"background-color":d},a.style.section={display:"none"},a.style.timer={"margin-top":"2.9375em"}}),a.$on("timer unfocus",function(){a.style.body={"background-color":c},a.style.section={display:"block"},a.style.timer={}})}angular.module("gjTimer").controller("gjTimerController",["$scope","$rootScope",a])}(),function(){"use strict";function a(){return function(a){return a.slice().reverse()}}angular.module("gjTimer").filter("reverse",a)}(),function(){"use strict";function a(){var a=this,b={"Rubik's Cube":"333","4x4 Cube":"444","5x5 Cube":"555","2x2 Cube":"222","3x3 blindfolded":"333bf","3x3 one-handed":"333oh",Megaminx:"minx",Pyraminx:"pyram","Square-1":"sq1","Rubik's Clock":"clock","6x6 Cube":"666","7x7 Cube":"777","4x4 blindfolded":"444bf","5x5 blindfolded":"555bf"},c={"Rubik's Cube":{ratio:.75,width:250},"4x4 Cube":{ratio:.75,width:250},"5x5 Cube":{ratio:.75,width:250},"2x2 Cube":{ratio:.75,width:250},"3x3 blindfolded":{ratio:.75,width:250},"3x3 one-handed":{ratio:.75,width:250},Megaminx:{ratio:.51,width:175},Pyraminx:{ratio:.69,width:250},"Square-1":{ratio:.57,width:175},"Rubik's Clock":{ratio:.5,width:175},"6x6 Cube":{ratio:.75,width:250},"7x7 Cube":{ratio:.75,width:250},"4x4 blindfolded":{ratio:.75,width:250},"5x5 blindfolded":{ratio:.75,width:250}},d={"Rubik's Cube":{"font-size":"16pt"},"4x4 Cube":{"font-size":"15pt"},"5x5 Cube":{"font-size":"15pt"},"2x2 Cube":{"font-size":"16pt"},"3x3 blindfolded":{"font-size":"16pt"},"3x3 one-handed":{"font-size":"16pt"},Megaminx:{"font-size":"13pt"},Pyraminx:{"font-size":"16pt"},"Square-1":{"font-size":"15pt"},"Rubik's Clock":{"font-size":"15pt"},"6x6 Cube":{"font-size":"13pt"},"7x7 Cube":{"font-size":"13pt"},"4x4 blindfolded":{"font-size":"15pt"},"5x5 blindfolded":{"font-size":"15pt"}};a.getEvents=function(){return b},a.getEventId=function(a){return b.hasOwnProperty(a)?b[a]:b["Rubik's Cube"]},a.getEventStyle=function(a){return d.hasOwnProperty(a)?d[a]:d["Rubik's Cube"]},a.getEventSvg=function(a){return c.hasOwnProperty(a)?c[a]:c["Rubik's Cube"]}}angular.module("gjTimer").service("Events",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"/dist/components/gjTimer/cub/cub.html",controller:"CubController",controllerAs:"ctrl",scope:{event:"="}}}angular.module("cub",[]).directive("cub",a)}(),function(){"use strict";function a(a,b){var c=this;a.$on("draw scramble",function(a,d,e){c.cub=b.drawScramble(d,e)})}angular.module("cub").controller("CubController",["$scope","CubService",a])}(),function(){"use strict";function a(a,b){var c=this;c.drawScramble=function(c,d){var e=b.getEventSvg(c).width,f=e/b.getEventSvg(c).ratio,g=document.createElement("div");scramblers[b.getEventId(c)].drawScramble(g,d,f,e);var h=document.createElement("div");return h.appendChild(g),a.trustAsHtml(h.innerHTML)}}angular.module("cub").service("CubService",["$sce","Events",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"/dist/components/gjTimer/menuBar/menuBar.html",controller:"MenuBarController",controllerAs:"ctrl",scope:{event:"=",sessionId:"=",settings:"="}}}angular.module("menuBar",[]).directive("menuBar",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this,h=20;g.events=f.getEvents(),g.session=e.init(),g.event=g.session.event,a.sessionId="session"+g.session.name.substr(8,g.session.name.length),a.event=g.event,a.settings={precision:2,timerStartDelay:100,timerStopDelay:100,timerRefreshInterval:50},c(function(){b.$broadcast("new scramble",a.event)},50),g.sessions=[];for(var i=0;h>i;i++)g.sessions[i]={};angular.forEach(g.sessions,function(a,b){a.name="Session "+(b+1)}),g.selectEvent=function(c){g.event=e.changeEvent("session"+g.session.name.substr(8,g.session.name.length),c),a.event=g.event,b.$broadcast("new scramble",a.event)},g.changeSession=function(c){g.session=e.changeSession("session"+c.substr(8,c.length)),a.sessionId="session"+c.substr(8,c.length),a.event=g.session.event,b.$broadcast("refresh data",a.sessionId),g.event!==g.session.event&&b.$broadcast("new scramble",a.event),g.event=a.event},g.settings=function(){d.open({animation:!0,templateUrl:"dist/components/gjTimer/settings/settings.html",controller:"SettingsController",controllerAs:"ctrl",size:"md",resolve:{settings:function(){return a.settings}}})},g.resetSession=function(){confirm("Are you sure you want to reset "+g.session.name+"?")&&(g.session=e.resetSession("session"+g.session.name.substr(8,g.session.name.length)),b.$broadcast("refresh data"))}}angular.module("menuBar").controller("MenuBarController",["$scope","$rootScope","$timeout","$uibModal","MenuBarService","Events",a])}(),function(){"use strict";function a(){var a=this,b=20;a.init=function(){var c;null!==localStorage.getItem("currentSessionId")?c=localStorage.getItem("currentSessionId"):(c=null!==localStorage.getItem("sessionNumber")?"session"+localStorage.getItem("sessionNumber"):"session1",localStorage.setItem("currentSessionId",c));for(var d={event:"Rubik's Cube",list:[]},e=1;b>=e;e++){var f=JSON.parse(localStorage.getItem("session"+e));null===f?(d.name="Session "+e,localStorage.setItem("session"+e,JSON.stringify(d))):null===f.event&&(f.event="Rubik's Cube",localStorage.setItem("session"+e,JSON.stringify(f)))}return a.getSession(c)},a.getSession=function(a){return JSON.parse(localStorage.getItem(a))},a.changeSession=function(b){return localStorage.setItem("currentSessionId",b),a.getSession(b)},a.resetSession=function(a){var b=JSON.parse(localStorage.getItem(a));return b.list=[],localStorage.setItem(a,JSON.stringify(b)),b},a.changeEvent=function(a,b){var c=JSON.parse(localStorage.getItem(a));return c.event=b,localStorage.setItem(a,JSON.stringify(c)),c.event}}angular.module("menuBar").service("MenuBarService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"/dist/components/gjTimer/results/results.html",controller:"ResultsController",controllerAs:"ctrl",scope:{results:"=",sessionId:"=",settings:"="}}}angular.module("results",[]).directive("results",a)}(),function(){"use strict";function a(a,b,c){var d=this;a.results=c.getResults(a.sessionId,a.settings.precision),d.results=a.results,a.$on("refresh data",function(b,e){a.results=c.getResults(e,a.settings.precision),d.results=a.results,"$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase&&a.$apply()}),d.openModal=function(c,d,e){c>=e&&b.open({animation:!0,templateUrl:"dist/components/gjTimer/resultsModal/resultsModal.html",controller:"ResultsModalController",controllerAs:"ctrl",size:"md",resolve:{data:function(){return{sessionId:a.sessionId,index:c,avg:d,numberOfResults:e}}}})},d.plus2=function(a){return c.plus2(a)}}angular.module("results").controller("ResultsController",["$scope","$uibModal","ResultsService",a])}(),function(){"use strict";function a(){var a=this;a.getResults=function(b,c){var d=JSON.parse(localStorage.getItem(b)).list;return angular.forEach(d,function(b,e){b.time=Number(b.time).toFixed(3),e>=4?b.avg5=a.calculateAverage(d.slice(e-4,e+1),c):b.avg5="DNF",e>=11?b.avg12=a.calculateAverage(d.slice(e-11,e+1),c):b.avg12="DNF"}),d},a.getModalResults=function(b,c,d){if(null===localStorage.getItem(b))return[];var e,f,g=JSON.parse(localStorage.getItem(b)).list.slice(c-d,c),h=[],i=2147485547;return angular.forEach(g,function(b){void 0!==b.penalty&&"(DNF)"===b.penalty?h.push(i):void 0!==b.penalty&&"(+2)"===b.penalty?h.push(a.timeToSeconds(b.time,3)+2):h.push(a.timeToSeconds(b.time,3))}),e=h.indexOf(Math.min.apply(null,h)),f=h.indexOf(Math.max.apply(null,h)),g[e].min=!0,g[f].max=!0,g},a.calculateAverage=function(b,c){if(b.length<3)return"DNF";var d=[],e=2147485547;return angular.forEach(b,function(b){void 0!==b.penalty&&"(DNF)"===b.penalty?d.push(e):void 0!==b.penalty&&"(+2)"===b.penalty?d.push(a.timeToSeconds(b.time,c)+2):d.push(a.timeToSeconds(b.time,c))}),d.splice(d.indexOf(Math.min.apply(null,d)),1),d.splice(d.indexOf(Math.max.apply(null,d)),1),d.indexOf(e)>=0?"DNF":(d.reduce(function(a,b){return a+b},0)/d.length).toFixed(c)},a.calculateMean=function(b,c){var d=[];return angular.forEach(b,function(b){return void 0!==b.penalty&&"(DNF)"===b.penalty?"DNF":void(void 0!==b.penalty&&"(+2)"===b.penalty?d.push(a.timeToSeconds(b.time,c)+2):d.push(a.timeToSeconds(b.time,c)))}),(d.reduce(function(a,b){return a+b},0)/d.length).toFixed(c)},a.calculateLargeMean=function(b,c){var d=[];return angular.forEach(b,function(b){void 0!==b.penalty&&"(+2)"===b.penalty?d.push(a.timeToSeconds(b.time,c)+2):(void 0===b.penalty||""===b.penalty)&&d.push(a.timeToSeconds(b.time,c))}),(d.reduce(function(a,b){return a+b},0)/d.length).toFixed(c)},a.plus2=function(b){return a.millisecondsToString(1e3*(a.timeToSeconds(b)+2))},a.timeToSeconds=function(a){var b=a.split(":");return 1===b.length?parseFloat(b[0]):2===b.length?60*parseFloat(b[0])+parseFloat(b[1]):3===b.length?3600*parseFloat(b[0])+60*parseFloat(b[1])+parseFloat(b[2]):-1},a.millisecondsToString=function(a){var b=moment(a);return 1e4>b?b.format("s.SSS"):6e4>b?b.format("ss.SSS"):6e5>b?b.format("m:ss.SSS"):36e5>b?b.utc().format("h:mm:ss.SSS"):void 0}}angular.module("results").service("ResultsService",[a])}(),function(){"use strict";function a(a,b,c){var d=this;d.title=b.avg+" average of "+b.numberOfResults,d.results=c.getModalResults(b.sessionId,b.index,b.numberOfResults),d.close=function(){a.dismiss()}}angular.module("results").controller("ResultsModalController",["$modalInstance","data","ResultsService",a])}(),function(){"use strict";function a(a,b,c,d,e,f){var g=function(){var a=d.defer(),b=e.get("dist/components/gjTimer/resultsPopover/resultsPopover.html");return"undefined"==typeof b?c.get("dist/components/gjTimer/resultsPopover/resultsPopover.html").success(function(b){e.put("dist/components/gjTimer/resultsPopover/resultsPopover.html",b),a.resolve(b)}):a.resolve(b),a.promise};return{restrict:"E",scope:{index:"=",result:"=",sessionId:"="},controller:"ResultsPopoverController",controllerAs:"ctrl",link:function(c,d,e){g().then(function(e){c.popoverDelay=1,a.insidePopover=-1;var g=c.result.time;"+2"===c.result.penalty?g=f.plus2(c.result.time)+"+":"DNF"===c.result.penalty&&(g="DNF("+c.result.time+")"),$(d).popover({animation:!1,content:e,html:!0,placement:"right",title:g}),$(d).bind("mouseenter",function(){c.insideDiv=c.index,b(function(){$(d).popover("show"),c.attachEvents(d)},c.popoverDelay)}),$(d).bind("mouseleave",function(){c.insideDiv=-1,b(function(){a.insidePopover!==c.index&&$(d).popover("hide")},c.popoverDelay)})})}}}angular.module("results").directive("resultsPopover",["$rootScope","$timeout","$http","$q","$templateCache","ResultsService",a])}(),function(){"use strict";function a(a,b,c,d){a.attachEvents=function(e){$(".popover").on("mouseenter",function(){b.insidePopover=a.index}).on("mouseleave",function(){b.insidePopover=-1,c(function(){a.insideDiv!==a.index&&$(e).popover("hide")},a.popoverDelay)}),$(".popover-btn-penalty-ok").on("click",function(){d.penalty(a.sessionId,a.index,""),b.$broadcast("refresh data",a.sessionId),$(e).popover("hide")}),$(".popover-btn-penalty-plus").on("click",function(){d.penalty(a.sessionId,a.index,"+2"),b.$broadcast("refresh data",a.sessionId),$(e).popover("hide")}),$(".popover-btn-penalty-dnf").on("click",function(){d.penalty(a.sessionId,a.index,"DNF"),b.$broadcast("refresh data",a.sessionId),$(e).popover("hide")}),$(".popover-btn-remove").on("click",function(){confirm("Are you sure you want to delete this time?")&&(d.remove(a.sessionId,a.index),b.$broadcast("refresh data",a.sessionId)),$(e).popover("hide")})}}angular.module("results").controller("ResultsPopoverController",["$scope","$rootScope","$timeout","ResultsPopoverService",a])}(),function(){"use strict";function a(){var a=this;a.penalty=function(a,b,c){var d=JSON.parse(localStorage.getItem(a));switch(c){case"":void 0!==d.list[b].penalty&&(delete d.list[b].penalty,localStorage.setItem(a,JSON.stringify(d)));break;case"+2":d.list[b].penalty="+2",localStorage.setItem(a,JSON.stringify(d));break;case"DNF":d.list[b].penalty="DNF",localStorage.setItem(a,JSON.stringify(d))}},a.remove=function(a,b){var c=JSON.parse(localStorage.getItem(a));c.list.splice(b,1),localStorage.setItem(a,JSON.stringify(c))},a.comment=function(a,b,c){console.log("comment "+a+" - "+b+" - "+c)}}angular.module("results").service("ResultsPopoverService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"/dist/components/gjTimer/scramble/scramble.html",controller:"ScrambleController",controllerAs:"ctrl",scope:{event:"=",scramble:"="}}}angular.module("scramble",[]).directive("scramble",a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this;a.$on("new scramble",function(g,h){a.scramble=d.newScramble(h),f.scramble=c.trustAsHtml(a.scramble),f.scrambleStyle=e.getEventStyle(h),b.$broadcast("draw scramble",h,d.getScrambleState())})}angular.module("scramble").controller("ScrambleController",["$scope","$rootScope","$sce","ScrambleService","Events",a])}(),function(){"use strict";function a(a){var b=this;b.getScramble=function(){return b.scramble.scramble_string},b.getScrambleState=function(){return b.scramble.state},b.newScramble=function(c){return b.scramble=scramblers[a.getEventId(c)].getRandomScramble(),b.scramble.scramble_string}}angular.module("scramble").service("ScrambleService",["Events",a])}(),function(){"use strict";function a(a,b,c){var d=this;d.settings=b,d.close=function(){a.dismiss()}}angular.module("menuBar").controller("SettingsController",["$modalInstance","settings","MenuBarService",a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"/dist/components/gjTimer/statistics/statistics.html",controller:"StatisticsController",controllerAs:"ctrl",scope:{event:"=",results:"="}}}angular.module("statistics",[]).directive("statistics",a)}(),function(){"use strict";function a(a,b){}angular.module("statistics").controller("StatisticsController",["$scope","StatisticsService",a])}(),function(){"use strict";function a(){}angular.module("statistics").service("StatisticsService",[a])}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"/dist/components/gjTimer/timer/timer.html",controller:"TimerController",controllerAs:"ctrl",scope:{event:"=",scramble:"=",sessionId:"=",settings:"="}}}angular.module("timer",[]).directive("timer",a)}(),function(){"use strict";function a(a,b,c,d,e){var f,g=this,h="reset",i=32;g.time=moment(0).format("s.SSS");var j={BLACK:{color:"#000000"},RED:{color:"#FF0000"},GREEN:{color:"#2EB82E"}};a.$on("keydown",function(k,l){"reset"===h&&l.keyCode===i?(h="keydown",g.time=moment(0).format("s.SSS"),g.timerStyle=j.RED,d(function(){"keydown"===h&&(h="ready",g.timerStyle=j.GREEN,b.$broadcast("timer focus"))},a.settings.timerStartDelay)):"timing"===h&&(h="stopped",c.cancel(f),b.$broadcast("timer unfocus"),e.saveResult(g.time,a.scramble,a.sessionId),b.$broadcast("refresh data",a.sessionId),b.$broadcast("new scramble",a.event))}),a.$on("keyup",function(b,k){g.timerStyle=j.BLACK,"ready"===h&&k.keyCode===i?(h="timing",e.startTimer(),f=c(function(){g.time=e.getTime()},a.settings.timerRefreshInterval)):"keydown"===h?h="reset":"stopped"===h&&d(function(){h="reset"},a.settings.timerStopDelay)})}angular.module("timer").controller("TimerController",["$scope","$rootScope","$interval","$timeout","TimerService",a])}(),function(){"use strict";function a(){var a,b=this;b.getTime=function(){var b=moment(Date.now()-a);return 1e4>b?b.format("s.SSS"):6e4>b?b.format("ss.SSS"):6e5>b?b.format("m:ss.SSS"):36e5>b?b.utc().format("h:mm:ss.SSS"):void 0},b.startTimer=function(){a=Date.now()},b.saveResult=function(a,b,c){var d={time:a,scramble:b,date:new Date},e=JSON.parse(localStorage.getItem(c));e.list.push(d),localStorage.setItem(c,JSON.stringify(e))}}angular.module("timer").service("TimerService",a)}();